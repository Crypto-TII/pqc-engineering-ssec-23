\doxysection{E\+:/pqc-\/engineering-\/ssec-\/23/d\+CTIDH/src/common/random.c File Reference}
\hypertarget{random_8c}{}\label{random_8c}\index{E:/pqc-\/engineering-\/ssec-\/23/dCTIDH/src/common/random.c@{E:/pqc-\/engineering-\/ssec-\/23/dCTIDH/src/common/random.c}}
{\ttfamily \#include $<$assert.\+h$>$}\newline
{\ttfamily \#include "{}random.\+h"{}}\newline
{\ttfamily \#include "{}../common/rng.\+h"{}}\newline
{\ttfamily \#include "{}int32\+\_\+sort.\+h"{}}\newline
{\ttfamily \#include "{}int32mask.\+h"{}}\newline
Include dependency graph for random.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d9/d8a/random_8c__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{random_8c_ace3b8cf474aa93ec9d8708ed8f6ddbc5}{random\+\_\+wombats}} (uint8\+\_\+t \texorpdfstring{$\ast$}{*}key, const long long numkeys, const long long \mbox{\hyperlink{primes_8h_a63de22a96a777bab244dd0850f58fed9}{batch\+\_\+start}}, const long long \mbox{\hyperlink{primes_8h_acc9e03579591509b3edb49d07bc8cca6}{batch\+\_\+stop}}, const long long batch\+\_\+sumykeys)
\item 
void \mbox{\hyperlink{random_8c_a878dd7cc85072c1c735d2a1df768a061}{random\+\_\+boundedl1}} (int8\+\_\+t \texorpdfstring{$\ast$}{*}e, const long long w, const long long S)
\item 
int64\+\_\+t \mbox{\hyperlink{random_8c_ad417abaeabbc971b4dcbcaee290fb292}{random\+\_\+coin}} (uint64\+\_\+t \mbox{\hyperlink{j-invariants_8m_ac23fb295847684aaafd24830017a8180}{num}}, uint64\+\_\+t den)
\end{DoxyCompactItemize}


\label{doc-func-members}
\Hypertarget{random_8c_doc-func-members}
\doxysubsection{Function Documentation}
\Hypertarget{random_8c_a878dd7cc85072c1c735d2a1df768a061}\index{random.c@{random.c}!random\_boundedl1@{random\_boundedl1}}
\index{random\_boundedl1@{random\_boundedl1}!random.c@{random.c}}
\doxysubsubsection{\texorpdfstring{random\_boundedl1()}{random\_boundedl1()}}
{\footnotesize\ttfamily \label{random_8c_a878dd7cc85072c1c735d2a1df768a061} 
void random\+\_\+boundedl1 (\begin{DoxyParamCaption}\item[{int8\+\_\+t \texorpdfstring{$\ast$}{*}}]{e}{, }\item[{const long long}]{w}{, }\item[{const long long}]{S}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{random_8c_source_l00063}{63}} of file \mbox{\hyperlink{random_8c_source}{random.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00064\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{comment}{//\ standard\ correspondences:}}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{comment}{//\ e[0],e[1],...,e[w-\/1]\ are\ w\ nonnegative\ integers}}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{comment}{//\ with\ sum\ at\ most\ S}}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{comment}{//\ <=>\ 1+e[0],1+e[1],...,1+e[w-\/1]\ are\ w\ positive\ integers}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{comment}{//\ with\ sum\ at\ most\ S+w}}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{comment}{//\ <=>\ 1+e[0],1+e[0]+1+e[1],...\ are\ w\ integers}}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{comment}{//\ in\ strictly\ increasing\ order}}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{comment}{//\ between\ 1\ and\ S+w}}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{comment}{//\ <=>\ e[0],1+e[0]+e[1],...\ are\ w\ integers}}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{comment}{//\ in\ strictly\ increasing\ order}}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{comment}{//\ between\ 0\ and\ S+w-\/1}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \mbox{\hyperlink{j-invariants_8m_aba44bac1e95ab5b14d78991821cf743c}{assert}}(w\ >=\ 0);}
\DoxyCodeLine{00078\ \ \ \ \ \mbox{\hyperlink{j-invariants_8m_aba44bac1e95ab5b14d78991821cf743c}{assert}}(w\ <\ 128);}
\DoxyCodeLine{00079\ \ \ \ \ \mbox{\hyperlink{j-invariants_8m_aba44bac1e95ab5b14d78991821cf743c}{assert}}(S\ >=\ 0);}
\DoxyCodeLine{00080\ \ \ \ \ \mbox{\hyperlink{j-invariants_8m_aba44bac1e95ab5b14d78991821cf743c}{assert}}(S\ <\ 128);}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordflow}{if}\ (!w)}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ rnum\ =\ S\ +\ w;}
\DoxyCodeLine{00085\ \ \ \ \ \mbox{\hyperlink{j-invariants_8m_aba44bac1e95ab5b14d78991821cf743c}{assert}}(rnum\ <=\ 254);}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{comment}{/*\ XXX:\ Microsoft\ compiler\ doesn't\ handle\ int32\_t\ r[S+w]\ */}}
\DoxyCodeLine{00087\ \ \ \ \ int32\_t\ r[254];}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordflow}{for}\ (;;)}
\DoxyCodeLine{00090\ \ \ \ \ \{\ \textcolor{comment}{/*\ rejection-\/sampling\ loop\ */}}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{c-code_2src_2rng_8c_aabbddb731663436423d24fa841900821}{randombytes}}(r,\ 4\ *\ rnum);}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ rnum;\ ++\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}})}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ r[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}]\ \&=\ \string~1;}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ w;\ ++\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}})}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ r[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}]\ |=\ 1;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{int32__sort_8h_ae059af982adfb60f176da9058368aa87}{int32\_sort}}(r,\ rnum);}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ collision\ =\ 0;}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ 1;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ w;\ ++\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}})}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ collision\ |=\ int32mask\_zero((r[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}]\ \string^\ r[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ -\/\ 1])\ \&\ \string~1);}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ crypto\_declassify(\&collision,sizeof\ collision);}}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (collision)}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ rnum;\ ++\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}})}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ r[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}]\ \&=\ 1;}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ now\ r\ has\ Hamming\ weight\ w}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ 1;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ rnum;\ ++\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}})}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ r[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}]\ +=\ r[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ -\/\ 1];}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ now\ r\ has\ >=0\ copies\ of\ 0,}}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ >=1\ copies\ of\ 1,\ >=1\ copies\ of\ 2,\ ...,\ >=1\ copies\ of\ w}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ <\ w;\ ++\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}})}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ numi\ =\ 0;}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ rnum;\ ++\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}})}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ numi\ -\/=\ int32mask\_equal(r[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}],\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}});}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ e[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}]\ =\ numi;}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ now\ e[0]>=0,\ e[1]>=1,\ e[2]>=1,\ ...,\ e[w-\/1]>=1}}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ ghost\ e[w]>=1,\ not\ stored}}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ e[0]+e[1]+...+e[w]\ =\ rnum}}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ so\ e[0]+e[1]+...+e[w-\/1]\ <=\ rnum-\/1}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ =\ 1;\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ <\ w;\ ++\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}})}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/e[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}];}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ now\ e[0]>=0,\ e[1]>=0,\ e[2]>=0,\ ...,\ e[w-\/1]>=0}}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ sum\ <=\ (rnum-\/1)-\/(w-\/1)}}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ i.e.\ sum\ <=\ S}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ not\ done\ yet:\ want\ to\ allow\ negative\ e}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ but\ simply\ negating\ will\ give\ zeros\ too\ much\ weight}}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ uniformity,\ keep\ e\ with\ probability\ 1/2\string^z}}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ where\ z\ is\ the\ number\ of\ zeros\ in\ e}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ speedup:\ actually\ keep\ e\ with\ probability\ 2\string^zmin/2\string^z}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ where\ zmin\ is\ minimum\ possible\ value\ of\ z}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ strategy:\ start\ counter\ at\ w-\/S}}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ decrease\ by\ 1\ for\ each\ zero\ bit}}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and,\ if\ negative,\ flip\ coin\ for\ each\ zero\ bit}}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ counter\ =\ w\ -\/\ S;}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{c-code_2src_2rng_8c_aabbddb731663436423d24fa841900821}{randombytes}}(r,\ 4\ *\ ((w\ +\ 31)\ /\ 32));}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ reject\ =\ 0;}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ <\ w;\ ++\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}})}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ int32\_t\ rbit\ =\ 1\ \&\ (r[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ /\ 32]\ >>\ (\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ \&\ 31));}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ int32\_t\ eizeromask\ =\ int32mask\_zero(e[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}]);}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ counter\ +=\ eizeromask;}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ reject\ |=\ int32mask\_negative(counter)\ \&\ eizeromask\ \&\ rbit;}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ crypto\_declassify(\&reject,sizeof\ reject);}}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (reject)}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ok\ to\ reuse\ randomness\ in\ r:}}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ bits\ used\ here\ are\ for\ e[i]\ nonzero,}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ bits\ used\ above\ are\ for\ e[i]\ zero}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ <\ w;\ ++\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}})}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \ int32\_t\ rbit\ =\ 1\ \&\ (r[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ /\ 32]\ >>\ (\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ \&\ 31));}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ e[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}]\ \string^=\ -\/rbit;}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ e[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}]\ +=\ rbit;}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \textcolor{preprocessor}{\#if\ defined(RVRSIDH)}}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ RiverSIDH\ \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ negative\ =\ 0,\ positive\ =\ 0;}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ <\ w;\ ++\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}})}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ negative\ +=\ int32mask\_negative(e[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}])\ \&\ e[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}];}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ positive\ +=\ \string~int32mask\_negative(e[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}])\ \&\ e[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}];}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((negative\ <\ -\/(S\ >>\ 1))\ ||\ (positive\ >\ (S\ >>\ 1)))}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}}
\DoxyCodeLine{00182\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00185\ \ \ \ \ \}}
\DoxyCodeLine{00186\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{j-invariants_8m_aba44bac1e95ab5b14d78991821cf743c}{assert()}}, \mbox{\hyperlink{prime__search_8m_source_l00010}{i}}, \mbox{\hyperlink{int32__sort_8h_source_l00006}{int32\+\_\+sort}}, \mbox{\hyperlink{prime__search_8m_source_l00012}{j}}, and \mbox{\hyperlink{c-code_2src_2rng_8c_source_l00008}{randombytes()}}.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=286pt]{dc/de5/random_8c_a878dd7cc85072c1c735d2a1df768a061_cgraph}
\end{center}
\end{figure}
\Hypertarget{random_8c_ad417abaeabbc971b4dcbcaee290fb292}\index{random.c@{random.c}!random\_coin@{random\_coin}}
\index{random\_coin@{random\_coin}!random.c@{random.c}}
\doxysubsubsection{\texorpdfstring{random\_coin()}{random\_coin()}}
{\footnotesize\ttfamily \label{random_8c_ad417abaeabbc971b4dcbcaee290fb292} 
int64\+\_\+t random\+\_\+coin (\begin{DoxyParamCaption}\item[{uint64\+\_\+t}]{num}{, }\item[{uint64\+\_\+t}]{den}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{random_8c_source_l00198}{198}} of file \mbox{\hyperlink{random_8c_source}{random.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00199\ \{}
\DoxyCodeLine{00200\ \ \ \ \ uint8\_t\ buf[32];}
\DoxyCodeLine{00201\ \ \ \ \ uint64\_t\ r\ =\ 0;}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \ \ \mbox{\hyperlink{c-code_2src_2rng_8c_aabbddb731663436423d24fa841900821}{randombytes}}(buf,\ \textcolor{keyword}{sizeof}\ buf);}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ <\ 256;\ ++\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}})}
\DoxyCodeLine{00206\ \ \ \ \ \{}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ uint64\_t\ bit\ =\ 1\ \&\ (buf[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ /\ 8]\ >>\ (\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ \&\ 7));}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ r\ <<=\ 1;}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ r\ +=\ bit;}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ r\ \string^=\ (\string~uint64mask\_lessthan(r,\ den))\ \&\ (r\ \string^\ (r\ -\/\ den));}
\DoxyCodeLine{00211\ \ \ \ \ \}}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{comment}{//\ XXX:\ speed\ this\ up}}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{keywordflow}{return}\ uint64mask\_lessthan(r,\ \mbox{\hyperlink{j-invariants_8m_ac23fb295847684aaafd24830017a8180}{num}});}
\DoxyCodeLine{00215\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{prime__search_8m_source_l00010}{i}}, \mbox{\hyperlink{j-invariants_8m_source_l00029}{num}}, and \mbox{\hyperlink{c-code_2src_2rng_8c_source_l00008}{randombytes()}}.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=260pt]{dc/de5/random_8c_ad417abaeabbc971b4dcbcaee290fb292_cgraph}
\end{center}
\end{figure}
\Hypertarget{random_8c_ace3b8cf474aa93ec9d8708ed8f6ddbc5}\index{random.c@{random.c}!random\_wombats@{random\_wombats}}
\index{random\_wombats@{random\_wombats}!random.c@{random.c}}
\doxysubsubsection{\texorpdfstring{random\_wombats()}{random\_wombats()}}
{\footnotesize\ttfamily \label{random_8c_ace3b8cf474aa93ec9d8708ed8f6ddbc5} 
void random\+\_\+wombats (\begin{DoxyParamCaption}\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{key}{, }\item[{const long long}]{numkeys}{, }\item[{const long long}]{batch\+\_\+start}{, }\item[{const long long}]{batch\+\_\+stop}{, }\item[{const long long}]{batch\+\_\+sumykeys}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{random_8c_source_l00015}{15}} of file \mbox{\hyperlink{random_8c_source}{random.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00016\ \{}
\DoxyCodeLine{00017\ \ \ \ \ int32\_t\ batch\_len\ =\ \mbox{\hyperlink{primes_8h_acc9e03579591509b3edb49d07bc8cca6}{batch\_stop}}\ -\/\ \mbox{\hyperlink{primes_8h_a63de22a96a777bab244dd0850f58fed9}{batch\_start}};}
\DoxyCodeLine{00018\ \ \ \ \ int32\_t\ r[4\ *\ batch\_len];}
\DoxyCodeLine{00019\ \ \ \ \ uint8\_t\ ells[numkeys];}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{keywordflow}{for}\ (;;)}
\DoxyCodeLine{00021\ \ \ \ \ \{\ \textcolor{comment}{/*\ rejection-\/sampling\ loop\ */}}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{c-code_2src_2rng_8c_aabbddb731663436423d24fa841900821}{randombytes}}(r,\ 4\ *\ batch\_len);}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ batch\_len;\ ++\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}})}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \ \ \ \ r[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}]\ \&=\ \string~1;}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ numkeys;\ ++\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}})}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \ \ \ \ r[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}]\ |=\ 1;}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{int32__sort_8h_ae059af982adfb60f176da9058368aa87}{int32\_sort}}(r,\ batch\_len);}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ collision\ =\ 0;}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ 1;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ numkeys;\ ++\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}})}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ collision\ |=\ int32mask\_zero((r[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}]\ \string^\ r[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ -\/\ 1])\ \&\ \string~1);}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#ifdef\ ENABLE\_CT\_TESTING}}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ VALGRIND\_MAKE\_MEM\_DEFINED(\&collision,\ \textcolor{keyword}{sizeof}(collision));}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (collision)}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ numkeys;\ ++\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}})}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \ \ \ \ ells[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}]\ =\ 0;}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ batch\_len;\ ++\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}})}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ r[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}]\ \&=\ 1;}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ <\ numkeys;\ ++\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}})}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}};\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ batch\_len;\ ++\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}})}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ r[j]\ \&=\ 1;}}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int32\_t\ updatemask\ =\ int32mask\_zero(ells[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}])\ \&\ int32mask\_nonzero(r[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}]);}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ r[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}]\ \string^=\ (1\ \&\ updatemask);}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ells[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}]\ |=\ (updatemask\ \&\ (\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ +\ 1));}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}\ <\ numkeys;\ ++\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}})}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ key[batch\_sumykeys\ +\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}]\ =\ \mbox{\hyperlink{primes_8h_a63de22a96a777bab244dd0850f58fed9}{batch\_start}}\ +\ ells[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}}]\ -\/\ 1;}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00060\ \ \ \ \ \}}
\DoxyCodeLine{00061\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{primes_8h_source_l00055}{batch\+\_\+start}}, \mbox{\hyperlink{primes_8h_source_l00056}{batch\+\_\+stop}}, \mbox{\hyperlink{prime__search_8m_source_l00010}{i}}, \mbox{\hyperlink{int32__sort_8h_source_l00006}{int32\+\_\+sort}}, \mbox{\hyperlink{prime__search_8m_source_l00012}{j}}, and \mbox{\hyperlink{c-code_2src_2rng_8c_source_l00008}{randombytes()}}.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=282pt]{dc/de5/random_8c_ace3b8cf474aa93ec9d8708ed8f6ddbc5_cgraph}
\end{center}
\end{figure}
