\doxysection{pip.\+\_\+internal.\+index.\+collector Namespace Reference}
\hypertarget{namespacepip_1_1__internal_1_1index_1_1collector}{}\label{namespacepip_1_1__internal_1_1index_1_1collector}\index{pip.\_internal.index.collector@{pip.\_internal.index.collector}}
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{classpip_1_1__internal_1_1index_1_1collector_1_1__NotAPIContent}{\+\_\+\+Not\+APIContent}}
\item 
class \mbox{\hyperlink{classpip_1_1__internal_1_1index_1_1collector_1_1__NotHTTP}{\+\_\+\+Not\+HTTP}}
\item 
class \mbox{\hyperlink{classpip_1_1__internal_1_1index_1_1collector_1_1CacheablePageContent}{Cacheable\+Page\+Content}}
\item 
class \mbox{\hyperlink{classpip_1_1__internal_1_1index_1_1collector_1_1CollectedSources}{Collected\+Sources}}
\item 
class \mbox{\hyperlink{classpip_1_1__internal_1_1index_1_1collector_1_1HTMLLinkParser}{HTMLLink\+Parser}}
\item 
class \mbox{\hyperlink{classpip_1_1__internal_1_1index_1_1collector_1_1IndexContent}{Index\+Content}}
\item 
class \mbox{\hyperlink{classpip_1_1__internal_1_1index_1_1collector_1_1LinkCollector}{Link\+Collector}}
\item 
class \mbox{\hyperlink{classpip_1_1__internal_1_1index_1_1collector_1_1ParseLinks}{Parse\+Links}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
Optional\mbox{[}str\mbox{]} \mbox{\hyperlink{namespacepip_1_1__internal_1_1index_1_1collector_aabde926725ae445f4be1a6f54d4db1fc}{\+\_\+match\+\_\+vcs\+\_\+scheme}} (str url)
\item 
\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{None}} \mbox{\hyperlink{namespacepip_1_1__internal_1_1index_1_1collector_aa50f329ed0f505e801d8044bdc880803}{\+\_\+ensure\+\_\+api\+\_\+header}} (\mbox{\hyperlink{classpip_1_1__vendor_1_1requests_1_1models_1_1Response}{Response}} response)
\item 
\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{None}} \mbox{\hyperlink{namespacepip_1_1__internal_1_1index_1_1collector_a6a61c507bdcf6674c736b47b6e299d5e}{\+\_\+ensure\+\_\+api\+\_\+response}} (str url, Pip\+Session session)
\item 
\mbox{\hyperlink{classpip_1_1__vendor_1_1requests_1_1models_1_1Response}{Response}} \mbox{\hyperlink{namespacepip_1_1__internal_1_1index_1_1collector_ac8a6cf6629f016c4d184b2b146eb65b4}{\+\_\+get\+\_\+simple\+\_\+response}} (str url, Pip\+Session session)
\item 
Optional\mbox{[}str\mbox{]} \mbox{\hyperlink{namespacepip_1_1__internal_1_1index_1_1collector_a790e7fd1960c7ff461c48b18bfb5a7d1}{\+\_\+get\+\_\+encoding\+\_\+from\+\_\+headers}} (\mbox{\hyperlink{namespacepip_1_1__internal_1_1index_1_1collector_acc8011d409502c4a78917f6308db8bdd}{Response\+Headers}} headers)
\item 
\mbox{\hyperlink{classpip_1_1__internal_1_1index_1_1collector_1_1ParseLinks}{Parse\+Links}} \mbox{\hyperlink{namespacepip_1_1__internal_1_1index_1_1collector_acc51c183456bf01f6547d990d383db94}{with\+\_\+cached\+\_\+index\+\_\+content}} (\mbox{\hyperlink{classpip_1_1__internal_1_1index_1_1collector_1_1ParseLinks}{Parse\+Links}} fn)
\item 
Iterable\mbox{[}\mbox{\hyperlink{classpip_1_1__internal_1_1models_1_1link_1_1Link}{Link}}\mbox{]} \mbox{\hyperlink{namespacepip_1_1__internal_1_1index_1_1collector_a56d5215ace05d08c82d3ceeb2697280c}{parse\+\_\+links}} ("{}Index\+Content"{} page)
\item 
\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{None}} \mbox{\hyperlink{namespacepip_1_1__internal_1_1index_1_1collector_a08debcfc9ae93f980ca5620d72b08e37}{\+\_\+handle\+\_\+get\+\_\+simple\+\_\+fail}} (\mbox{\hyperlink{classpip_1_1__internal_1_1models_1_1link_1_1Link}{Link}} link, Union\mbox{[}str, Exception\mbox{]} reason, Optional\mbox{[}Callable\mbox{[}..., \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{None}}\mbox{]}\mbox{]} \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{meth}}=\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{None}})
\item 
\mbox{\hyperlink{classpip_1_1__internal_1_1index_1_1collector_1_1IndexContent}{Index\+Content}} \mbox{\hyperlink{namespacepip_1_1__internal_1_1index_1_1collector_a86f5174b80e603975de77b610eeaa710}{\+\_\+make\+\_\+index\+\_\+content}} (\mbox{\hyperlink{classpip_1_1__vendor_1_1requests_1_1models_1_1Response}{Response}} response, bool cache\+\_\+link\+\_\+parsing=True)
\item 
Optional\mbox{[}"{}Index\+Content"{}\mbox{]} \mbox{\hyperlink{namespacepip_1_1__internal_1_1index_1_1collector_ad094bc88b1c809a3e91917156f409c31}{\+\_\+get\+\_\+index\+\_\+content}} (\mbox{\hyperlink{classpip_1_1__internal_1_1models_1_1link_1_1Link}{Link}} link, \texorpdfstring{$\ast$}{*}Pip\+Session session)
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacepip_1_1__internal_1_1index_1_1collector_aac39b55be6469395f55ff0292ad8184c}{Protocol}} = object
\item 
\mbox{\hyperlink{namespacepip_1_1__internal_1_1index_1_1collector_a0b14e488ae28d98d262453f3e9cd6e4d}{logger}} = logging.\+get\+Logger(\+\_\+\+\_\+name\+\_\+\+\_\+)
\item 
\mbox{\hyperlink{namespacepip_1_1__internal_1_1index_1_1collector_acc8011d409502c4a78917f6308db8bdd}{Response\+Headers}} = Mutable\+Mapping\mbox{[}str, str\mbox{]}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyVerb}The main purpose of this module is to expose LinkCollector.collect_sources().
\end{DoxyVerb}
 

\doxysubsection{Function Documentation}
\Hypertarget{namespacepip_1_1__internal_1_1index_1_1collector_aa50f329ed0f505e801d8044bdc880803}\label{namespacepip_1_1__internal_1_1index_1_1collector_aa50f329ed0f505e801d8044bdc880803} 
\index{pip.\_internal.index.collector@{pip.\_internal.index.collector}!\_ensure\_api\_header@{\_ensure\_api\_header}}
\index{\_ensure\_api\_header@{\_ensure\_api\_header}!pip.\_internal.index.collector@{pip.\_internal.index.collector}}
\doxysubsubsection{\texorpdfstring{\_ensure\_api\_header()}{\_ensure\_api\_header()}}
{\footnotesize\ttfamily  \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{None}} \+\_\+ensure\+\_\+api\+\_\+header (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classpip_1_1__vendor_1_1requests_1_1models_1_1Response}{Response}}}]{response }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Check the Content-Type header to ensure the response contains a Simple
API Response.

Raises `_NotAPIContent` if the content type is not a valid content-type.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{collector_8py_source_l00073}{73}} of file \mbox{\hyperlink{collector_8py_source}{collector.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00073\ \textcolor{keyword}{def\ }\_ensure\_api\_header(response:\ Response)\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00075\ \textcolor{stringliteral}{\ \ \ \ Check\ the\ Content-\/Type\ header\ to\ ensure\ the\ response\ contains\ a\ Simple}}
\DoxyCodeLine{00076\ \textcolor{stringliteral}{\ \ \ \ API\ Response.}}
\DoxyCodeLine{00077\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00078\ \textcolor{stringliteral}{\ \ \ \ Raises\ \`{}\_NotAPIContent\`{}\ if\ the\ content\ type\ is\ not\ a\ valid\ content-\/type.}}
\DoxyCodeLine{00079\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{00080\ \ \ \ \ content\_type\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{response.headers.get}}(\textcolor{stringliteral}{"{}Content-\/Type"{}},\ \textcolor{stringliteral}{"{}Unknown"{}})}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ content\_type\_l\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{content\_type.lower}}()}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{content\_type\_l.startswith}}(}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ (}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}text/html"{}},}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}application/vnd.pypi.simple.v1+html"{}},}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}application/vnd.pypi.simple.v1+json"{}},}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00089\ \ \ \ \ ):}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordflow}{raise}\ \_NotAPIContent(content\_type,\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{response.request.method}})}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ }

\end{DoxyCode}


References \mbox{\hyperlink{prime__search_8m_source_l00010}{i}}.



Referenced by \mbox{\hyperlink{collector_8py_source_l00117}{pip.\+\_\+internal.\+index.\+collector.\+\_\+get\+\_\+simple\+\_\+response()}}.

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/def/namespacepip_1_1__internal_1_1index_1_1collector_aa50f329ed0f505e801d8044bdc880803_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacepip_1_1__internal_1_1index_1_1collector_a6a61c507bdcf6674c736b47b6e299d5e}\label{namespacepip_1_1__internal_1_1index_1_1collector_a6a61c507bdcf6674c736b47b6e299d5e} 
\index{pip.\_internal.index.collector@{pip.\_internal.index.collector}!\_ensure\_api\_response@{\_ensure\_api\_response}}
\index{\_ensure\_api\_response@{\_ensure\_api\_response}!pip.\_internal.index.collector@{pip.\_internal.index.collector}}
\doxysubsubsection{\texorpdfstring{\_ensure\_api\_response()}{\_ensure\_api\_response()}}
{\footnotesize\ttfamily  \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{None}} \+\_\+ensure\+\_\+api\+\_\+response (\begin{DoxyParamCaption}\item[{str}]{url,  }\item[{Pip\+Session}]{session }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Send a HEAD request to the URL, and ensure the response contains a simple
API Response.

Raises `_NotHTTP` if the URL is not available for a HEAD request, or
`_NotAPIContent` if the content type is not a valid content type.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{collector_8py_source_l00099}{99}} of file \mbox{\hyperlink{collector_8py_source}{collector.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00099\ \textcolor{keyword}{def\ }\_ensure\_api\_response(url:\ str,\ session:\ PipSession)\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00101\ \textcolor{stringliteral}{\ \ \ \ Send\ a\ HEAD\ request\ to\ the\ URL,\ and\ ensure\ the\ response\ contains\ a\ simple}}
\DoxyCodeLine{00102\ \textcolor{stringliteral}{\ \ \ \ API\ Response.}}
\DoxyCodeLine{00103\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00104\ \textcolor{stringliteral}{\ \ \ \ Raises\ \`{}\_NotHTTP\`{}\ if\ the\ URL\ is\ not\ available\ for\ a\ HEAD\ request,\ or}}
\DoxyCodeLine{00105\ \textcolor{stringliteral}{\ \ \ \ \`{}\_NotAPIContent\`{}\ if\ the\ content\ type\ is\ not\ a\ valid\ content\ type.}}
\DoxyCodeLine{00106\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{00107\ \ \ \ \ scheme,\ netloc,\ path,\ query,\ fragment\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{urllib.parse.urlsplit}}(url)}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keywordflow}{if}\ scheme\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ \{\textcolor{stringliteral}{"{}http"{}},\ \textcolor{stringliteral}{"{}https"{}}\}:}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \_NotHTTP()}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ resp\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{session.head}}(url,\ allow\_redirects=\textcolor{keyword}{True})}
\DoxyCodeLine{00112\ \ \ \ \ raise\_for\_status(resp)}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ \_ensure\_api\_header(resp)}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ }

\end{DoxyCode}


Referenced by \mbox{\hyperlink{collector_8py_source_l00117}{pip.\+\_\+internal.\+index.\+collector.\+\_\+get\+\_\+simple\+\_\+response()}}.

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/def/namespacepip_1_1__internal_1_1index_1_1collector_a6a61c507bdcf6674c736b47b6e299d5e_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacepip_1_1__internal_1_1index_1_1collector_a790e7fd1960c7ff461c48b18bfb5a7d1}\label{namespacepip_1_1__internal_1_1index_1_1collector_a790e7fd1960c7ff461c48b18bfb5a7d1} 
\index{pip.\_internal.index.collector@{pip.\_internal.index.collector}!\_get\_encoding\_from\_headers@{\_get\_encoding\_from\_headers}}
\index{\_get\_encoding\_from\_headers@{\_get\_encoding\_from\_headers}!pip.\_internal.index.collector@{pip.\_internal.index.collector}}
\doxysubsubsection{\texorpdfstring{\_get\_encoding\_from\_headers()}{\_get\_encoding\_from\_headers()}}
{\footnotesize\ttfamily  Optional\mbox{[}str\mbox{]} \+\_\+get\+\_\+encoding\+\_\+from\+\_\+headers (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacepip_1_1__internal_1_1index_1_1collector_acc8011d409502c4a78917f6308db8bdd}{Response\+Headers}}}]{headers }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Determine if we have any encoding information in our headers.\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{collector_8py_source_l00180}{180}} of file \mbox{\hyperlink{collector_8py_source}{collector.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00180\ \textcolor{keyword}{def\ }\_get\_encoding\_from\_headers(headers:\ ResponseHeaders)\ -\/>\ Optional[str]:}
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Determine\ if\ we\ have\ any\ encoding\ information\ in\ our\ headers."{}"{}"{}}}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordflow}{if}\ headers\ \textcolor{keywordflow}{and}\ \textcolor{stringliteral}{"{}Content-\/Type"{}}\ \textcolor{keywordflow}{in}\ headers:}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ m\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{email.message.Message}}()}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ m[\textcolor{stringliteral}{"{}content-\/type"{}}]\ =\ headers[\textcolor{stringliteral}{"{}Content-\/Type"{}}]}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ charset\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{m.get\_param}}(\textcolor{stringliteral}{"{}charset"{}})}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ charset:}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ str(charset)}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ }

\end{DoxyCode}


References \mbox{\hyperlink{prime__search_8m_source_l00010}{i}}.



Referenced by \mbox{\hyperlink{collector_8py_source_l00325}{pip.\+\_\+internal.\+index.\+collector.\+\_\+make\+\_\+index\+\_\+content()}}.

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/def/namespacepip_1_1__internal_1_1index_1_1collector_a790e7fd1960c7ff461c48b18bfb5a7d1_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacepip_1_1__internal_1_1index_1_1collector_ad094bc88b1c809a3e91917156f409c31}\label{namespacepip_1_1__internal_1_1index_1_1collector_ad094bc88b1c809a3e91917156f409c31} 
\index{pip.\_internal.index.collector@{pip.\_internal.index.collector}!\_get\_index\_content@{\_get\_index\_content}}
\index{\_get\_index\_content@{\_get\_index\_content}!pip.\_internal.index.collector@{pip.\_internal.index.collector}}
\doxysubsubsection{\texorpdfstring{\_get\_index\_content()}{\_get\_index\_content()}}
{\footnotesize\ttfamily  Optional\mbox{[}"{}Index\+Content"{}\mbox{]} \+\_\+get\+\_\+index\+\_\+content (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classpip_1_1__internal_1_1models_1_1link_1_1Link}{Link}}}]{link,  }\item[{\texorpdfstring{$\ast$}{*}Pip\+Session}]{session }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Definition at line \mbox{\hyperlink{collector_8py_source_l00336}{336}} of file \mbox{\hyperlink{collector_8py_source}{collector.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00336\ \textcolor{keyword}{def\ }\_get\_index\_content(link:\ Link,\ *,\ session:\ PipSession)\ -\/>\ Optional[\textcolor{stringliteral}{"{}IndexContent"{}}]:}
\DoxyCodeLine{00337\ \ \ \ \ url\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{link.url.split}}(\textcolor{stringliteral}{"{}\#"{}},\ 1)[0]}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \ \ \textcolor{comment}{\#\ Check\ for\ VCS\ schemes\ that\ do\ not\ support\ lookup\ as\ web\ pages.}}
\DoxyCodeLine{00340\ \ \ \ \ vcs\_scheme\ =\ \_match\_vcs\_scheme(url)}
\DoxyCodeLine{00341\ \ \ \ \ \textcolor{keywordflow}{if}\ vcs\_scheme:}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{logger.warning}}(}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Cannot\ look\ at\ \%s\ URL\ \%s\ because\ it\ does\ not\ support\ lookup\ as\ web\ pages."{}},}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ \ \ vcs\_scheme,}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ \ \ link,}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00349\ \ \ \ \ \textcolor{comment}{\#\ Tack\ index.html\ onto\ file://\ URLs\ that\ point\ to\ directories}}
\DoxyCodeLine{00350\ \ \ \ \ scheme,\ \_,\ path,\ \_,\ \_,\ \_\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{urllib.parse.urlparse}}(url)}
\DoxyCodeLine{00351\ \ \ \ \ \textcolor{keywordflow}{if}\ scheme\ ==\ \textcolor{stringliteral}{"{}file"{}}\ \textcolor{keywordflow}{and}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{os.path.isdir}}(\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{urllib.request.url2pathname}}(path)):}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ add\ trailing\ slash\ if\ not\ present\ so\ urljoin\ doesn't\ trim}}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ final\ segment}}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{url.endswith}}(\textcolor{stringliteral}{"{}/"{}}):}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \ \ \ \ url\ +=\ \textcolor{stringliteral}{"{}/"{}}}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ TODO:\ In\ the\ future,\ it\ would\ be\ nice\ if\ pip\ supported\ PEP\ 691}}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ \ \ \ \ style\ responses\ in\ the\ file://\ URLs,\ however\ there's\ no}}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ \ \ \ \ standard\ file\ extension\ for\ application/vnd.pypi.simple.v1+json}}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ \ \ \ \ so\ we'll\ need\ to\ come\ up\ with\ something\ on\ our\ own.}}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ url\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{urllib.parse.urljoin}}(url,\ \textcolor{stringliteral}{"{}index.html"{}})}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{logger.debug}}(\textcolor{stringliteral}{"{}\ file:\ URL\ is\ directory,\ getting\ \%s"{}},\ url)}
\DoxyCodeLine{00362\ }
\DoxyCodeLine{00363\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ resp\ =\ \_get\_simple\_response(url,\ session=session)}
\DoxyCodeLine{00365\ \ \ \ \ \textcolor{keywordflow}{except}\ \_NotHTTP:}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{logger.warning}}(}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Skipping\ page\ \%s\ because\ it\ looks\ like\ an\ archive,\ and\ cannot\ "{}}}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}be\ checked\ by\ a\ HTTP\ HEAD\ request."{}},}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \ \ \ \ link,}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{keywordflow}{except}\ \_NotAPIContent\ \textcolor{keyword}{as}\ exc:}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{logger.warning}}(}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Skipping\ page\ \%s\ because\ the\ \%s\ request\ got\ Content-\/Type:\ \%s.\ "{}}}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ only\ supported\ Content-\/Types\ are\ application/vnd.pypi.simple.v1+json,\ "{}}}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}application/vnd.pypi.simple.v1+html,\ and\ text/html"{}},}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ \ \ link,}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{exc.request\_desc}},}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{exc.content\_type}},}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{keywordflow}{except}\ NetworkConnectionError\ \textcolor{keyword}{as}\ exc:}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \_handle\_get\_simple\_fail(link,\ exc)}
\DoxyCodeLine{00382\ \ \ \ \ \textcolor{keywordflow}{except}\ RetryError\ \textcolor{keyword}{as}\ exc:}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \_handle\_get\_simple\_fail(link,\ exc)}
\DoxyCodeLine{00384\ \ \ \ \ \textcolor{keywordflow}{except}\ SSLError\ \textcolor{keyword}{as}\ exc:}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ reason\ =\ \textcolor{stringliteral}{"{}There\ was\ a\ problem\ confirming\ the\ ssl\ certificate:\ "{}}}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ reason\ +=\ str(exc)}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \_handle\_get\_simple\_fail(link,\ reason,\ meth=\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{logger.info}})}
\DoxyCodeLine{00388\ \ \ \ \ \textcolor{keywordflow}{except}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{requests.ConnectionError}}\ \textcolor{keyword}{as}\ exc:}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \_handle\_get\_simple\_fail(link,\ f\textcolor{stringliteral}{"{}connection\ error:\ \{exc\}"{}})}
\DoxyCodeLine{00390\ \ \ \ \ \textcolor{keywordflow}{except}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{requests.Timeout}}:}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \_handle\_get\_simple\_fail(link,\ \textcolor{stringliteral}{"{}timed\ out"{}})}
\DoxyCodeLine{00392\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_make\_index\_content(resp,\ cache\_link\_parsing=\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{link.cache\_link\_parsing}})}
\DoxyCodeLine{00394\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00396\ }

\end{DoxyCode}


References \mbox{\hyperlink{collector_8py_source_l00117}{pip.\+\_\+internal.\+index.\+collector.\+\_\+get\+\_\+simple\+\_\+response()}}, \mbox{\hyperlink{collector_8py_source_l00317}{pip.\+\_\+internal.\+index.\+collector.\+\_\+handle\+\_\+get\+\_\+simple\+\_\+fail()}}, \mbox{\hyperlink{collector_8py_source_l00325}{pip.\+\_\+internal.\+index.\+collector.\+\_\+make\+\_\+index\+\_\+content()}}, \mbox{\hyperlink{collector_8py_source_l00055}{pip.\+\_\+internal.\+index.\+collector.\+\_\+match\+\_\+vcs\+\_\+scheme()}}, and \mbox{\hyperlink{prime__search_8m_source_l00010}{i}}.



Referenced by \mbox{\hyperlink{collector_8py_source_l00457}{Link\+Collector.\+fetch\+\_\+response()}}.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/def/namespacepip_1_1__internal_1_1index_1_1collector_ad094bc88b1c809a3e91917156f409c31_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/def/namespacepip_1_1__internal_1_1index_1_1collector_ad094bc88b1c809a3e91917156f409c31_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacepip_1_1__internal_1_1index_1_1collector_ac8a6cf6629f016c4d184b2b146eb65b4}\label{namespacepip_1_1__internal_1_1index_1_1collector_ac8a6cf6629f016c4d184b2b146eb65b4} 
\index{pip.\_internal.index.collector@{pip.\_internal.index.collector}!\_get\_simple\_response@{\_get\_simple\_response}}
\index{\_get\_simple\_response@{\_get\_simple\_response}!pip.\_internal.index.collector@{pip.\_internal.index.collector}}
\doxysubsubsection{\texorpdfstring{\_get\_simple\_response()}{\_get\_simple\_response()}}
{\footnotesize\ttfamily  \mbox{\hyperlink{classpip_1_1__vendor_1_1requests_1_1models_1_1Response}{Response}} \+\_\+get\+\_\+simple\+\_\+response (\begin{DoxyParamCaption}\item[{str}]{url,  }\item[{Pip\+Session}]{session }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Access an Simple API response with GET, and return the response.

This consists of three parts:

1. If the URL looks suspiciously like an archive, send a HEAD first to
   check the Content-Type is HTML or Simple API, to avoid downloading a
   large file. Raise `_NotHTTP` if the content type cannot be determined, or
   `_NotAPIContent` if it is not HTML or a Simple API.
2. Actually perform the request. Raise HTTP exceptions on network failures.
3. Check the Content-Type header to make sure we got a Simple API response,
   and raise `_NotAPIContent` otherwise.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{collector_8py_source_l00117}{117}} of file \mbox{\hyperlink{collector_8py_source}{collector.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00117\ \textcolor{keyword}{def\ }\_get\_simple\_response(url:\ str,\ session:\ PipSession)\ -\/>\ Response:}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Access\ an\ Simple\ API\ response\ with\ GET,\ and\ return\ the\ response.}}
\DoxyCodeLine{00119\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00120\ \textcolor{stringliteral}{\ \ \ \ This\ consists\ of\ three\ parts:}}
\DoxyCodeLine{00121\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00122\ \textcolor{stringliteral}{\ \ \ \ 1.\ If\ the\ URL\ looks\ suspiciously\ like\ an\ archive,\ send\ a\ HEAD\ first\ to}}
\DoxyCodeLine{00123\ \textcolor{stringliteral}{\ \ \ \ \ \ \ check\ the\ Content-\/Type\ is\ HTML\ or\ Simple\ API,\ to\ avoid\ downloading\ a}}
\DoxyCodeLine{00124\ \textcolor{stringliteral}{\ \ \ \ \ \ \ large\ file.\ Raise\ \`{}\_NotHTTP\`{}\ if\ the\ content\ type\ cannot\ be\ determined,\ or}}
\DoxyCodeLine{00125\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \`{}\_NotAPIContent\`{}\ if\ it\ is\ not\ HTML\ or\ a\ Simple\ API.}}
\DoxyCodeLine{00126\ \textcolor{stringliteral}{\ \ \ \ 2.\ Actually\ perform\ the\ request.\ Raise\ HTTP\ exceptions\ on\ network\ failures.}}
\DoxyCodeLine{00127\ \textcolor{stringliteral}{\ \ \ \ 3.\ Check\ the\ Content-\/Type\ header\ to\ make\ sure\ we\ got\ a\ Simple\ API\ response,}}
\DoxyCodeLine{00128\ \textcolor{stringliteral}{\ \ \ \ \ \ \ and\ raise\ \`{}\_NotAPIContent\`{}\ otherwise.}}
\DoxyCodeLine{00129\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordflow}{if}\ is\_archive\_file(Link(url).filename):}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \_ensure\_api\_response(url,\ session=session)}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{logger.debug}}(\textcolor{stringliteral}{"{}Getting\ page\ \%s"{}},\ redact\_auth\_from\_url(url))}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ resp\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{session.get}}(}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ url,}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ headers=\{}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Accept"{}}:\ \textcolor{stringliteral}{"{},\ "{}}.join(}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}application/vnd.pypi.simple.v1+json"{}},}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}application/vnd.pypi.simple.v1+html;\ q=0.1"{}},}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}text/html;\ q=0.01"{}},}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ]}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ We\ don't\ want\ to\ blindly\ returned\ cached\ data\ for}}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ /simple/,\ because\ authors\ generally\ expecting\ that}}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ twine\ upload\ \&\&\ pip\ install\ will\ function,\ but\ if}}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ they've\ done\ a\ pip\ install\ in\ the\ last\ \string~10\ minutes}}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ it\ won't.\ Thus\ by\ setting\ this\ to\ zero\ we\ will\ not}}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ blindly\ use\ any\ cached\ data,\ however\ the\ benefit\ of}}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ using\ max-\/age=0\ instead\ of\ no-\/cache,\ is\ that\ we\ will}}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ still\ support\ conditional\ requests,\ so\ we\ will\ still}}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ minimize\ traffic\ sent\ in\ cases\ where\ the\ page\ hasn't}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ changed\ at\ all,\ we\ will\ just\ always\ incur\ the\ round}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ trip\ for\ the\ conditional\ GET\ now\ instead\ of\ only}}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ once\ per\ 10\ minutes.}}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ For\ more\ information,\ please\ see\ pypa/pip\#5670.}}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Cache-\/Control"{}}:\ \textcolor{stringliteral}{"{}max-\/age=0"{}},}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \},}
\DoxyCodeLine{00160\ \ \ \ \ )}
\DoxyCodeLine{00161\ \ \ \ \ raise\_for\_status(resp)}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{comment}{\#\ The\ check\ for\ archives\ above\ only\ works\ if\ the\ url\ ends\ with}}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{comment}{\#\ something\ that\ looks\ like\ an\ archive.\ However\ that\ is\ not\ a}}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{comment}{\#\ requirement\ of\ an\ url.\ Unless\ we\ issue\ a\ HEAD\ request\ on\ every}}
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{comment}{\#\ url\ we\ cannot\ know\ ahead\ of\ time\ for\ sure\ if\ something\ is\ a}}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{comment}{\#\ Simple\ API\ response\ or\ not.\ However\ we\ can\ check\ after\ we've}}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{comment}{\#\ downloaded\ it.}}
\DoxyCodeLine{00169\ \ \ \ \ \_ensure\_api\_header(resp)}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \ \ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{logger.debug}}(}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Fetched\ page\ \%s\ as\ \%s"{}},}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ redact\_auth\_from\_url(url),}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{resp.headers.get}}(\textcolor{stringliteral}{"{}Content-\/Type"{}},\ \textcolor{stringliteral}{"{}Unknown"{}}),}
\DoxyCodeLine{00175\ \ \ \ \ )}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keywordflow}{return}\ resp}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ }

\end{DoxyCode}


References \mbox{\hyperlink{collector_8py_source_l00073}{pip.\+\_\+internal.\+index.\+collector.\+\_\+ensure\+\_\+api\+\_\+header()}}, \mbox{\hyperlink{collector_8py_source_l00099}{pip.\+\_\+internal.\+index.\+collector.\+\_\+ensure\+\_\+api\+\_\+response()}}, and \mbox{\hyperlink{prime__search_8m_source_l00010}{i}}.



Referenced by \mbox{\hyperlink{collector_8py_source_l00336}{pip.\+\_\+internal.\+index.\+collector.\+\_\+get\+\_\+index\+\_\+content()}}.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=343pt]{dc/def/namespacepip_1_1__internal_1_1index_1_1collector_ac8a6cf6629f016c4d184b2b146eb65b4_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/def/namespacepip_1_1__internal_1_1index_1_1collector_ac8a6cf6629f016c4d184b2b146eb65b4_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacepip_1_1__internal_1_1index_1_1collector_a08debcfc9ae93f980ca5620d72b08e37}\label{namespacepip_1_1__internal_1_1index_1_1collector_a08debcfc9ae93f980ca5620d72b08e37} 
\index{pip.\_internal.index.collector@{pip.\_internal.index.collector}!\_handle\_get\_simple\_fail@{\_handle\_get\_simple\_fail}}
\index{\_handle\_get\_simple\_fail@{\_handle\_get\_simple\_fail}!pip.\_internal.index.collector@{pip.\_internal.index.collector}}
\doxysubsubsection{\texorpdfstring{\_handle\_get\_simple\_fail()}{\_handle\_get\_simple\_fail()}}
{\footnotesize\ttfamily  \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{None}} \+\_\+handle\+\_\+get\+\_\+simple\+\_\+fail (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classpip_1_1__internal_1_1models_1_1link_1_1Link}{Link}}}]{link,  }\item[{Union\mbox{[}str, Exception\mbox{]}}]{reason,  }\item[{Optional\mbox{[}Callable\mbox{[}..., \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{None}}\mbox{]}\mbox{]} }]{meth = {\ttfamily \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{None}}} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Definition at line \mbox{\hyperlink{collector_8py_source_l00313}{313}} of file \mbox{\hyperlink{collector_8py_source}{collector.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00317\ )\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00318\ \ \ \ \ \textcolor{keywordflow}{if}\ meth\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ meth\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{logger.debug}}}
\DoxyCodeLine{00320\ \ \ \ \ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{meth}}(\textcolor{stringliteral}{"{}Could\ not\ fetch\ URL\ \%s:\ \%s\ -\/\ skipping"{}},\ link,\ reason)}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ }

\end{DoxyCode}


References \mbox{\hyperlink{prime__search_8m_source_l00010}{i}}.



Referenced by \mbox{\hyperlink{collector_8py_source_l00336}{pip.\+\_\+internal.\+index.\+collector.\+\_\+get\+\_\+index\+\_\+content()}}.

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/def/namespacepip_1_1__internal_1_1index_1_1collector_a08debcfc9ae93f980ca5620d72b08e37_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacepip_1_1__internal_1_1index_1_1collector_a86f5174b80e603975de77b610eeaa710}\label{namespacepip_1_1__internal_1_1index_1_1collector_a86f5174b80e603975de77b610eeaa710} 
\index{pip.\_internal.index.collector@{pip.\_internal.index.collector}!\_make\_index\_content@{\_make\_index\_content}}
\index{\_make\_index\_content@{\_make\_index\_content}!pip.\_internal.index.collector@{pip.\_internal.index.collector}}
\doxysubsubsection{\texorpdfstring{\_make\_index\_content()}{\_make\_index\_content()}}
{\footnotesize\ttfamily  \mbox{\hyperlink{classpip_1_1__internal_1_1index_1_1collector_1_1IndexContent}{Index\+Content}} \+\_\+make\+\_\+index\+\_\+content (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classpip_1_1__vendor_1_1requests_1_1models_1_1Response}{Response}}}]{response,  }\item[{bool }]{cache\+\_\+link\+\_\+parsing = {\ttfamily True} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Definition at line \mbox{\hyperlink{collector_8py_source_l00323}{323}} of file \mbox{\hyperlink{collector_8py_source}{collector.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00325\ )\ -\/>\ IndexContent:}
\DoxyCodeLine{00326\ \ \ \ \ encoding\ =\ \_get\_encoding\_from\_headers(\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{response.headers}})}
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{keywordflow}{return}\ IndexContent(}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{response.content}},}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{response.headers}}[\textcolor{stringliteral}{"{}Content-\/Type"{}}],}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ encoding=encoding,}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ url=\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{response.url}},}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ cache\_link\_parsing=cache\_link\_parsing,}
\DoxyCodeLine{00333\ \ \ \ \ )}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ }

\end{DoxyCode}


References \mbox{\hyperlink{collector_8py_source_l00180}{pip.\+\_\+internal.\+index.\+collector.\+\_\+get\+\_\+encoding\+\_\+from\+\_\+headers()}}, and \mbox{\hyperlink{prime__search_8m_source_l00010}{i}}.



Referenced by \mbox{\hyperlink{collector_8py_source_l00336}{pip.\+\_\+internal.\+index.\+collector.\+\_\+get\+\_\+index\+\_\+content()}}.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=331pt]{dc/def/namespacepip_1_1__internal_1_1index_1_1collector_a86f5174b80e603975de77b610eeaa710_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/def/namespacepip_1_1__internal_1_1index_1_1collector_a86f5174b80e603975de77b610eeaa710_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacepip_1_1__internal_1_1index_1_1collector_aabde926725ae445f4be1a6f54d4db1fc}\label{namespacepip_1_1__internal_1_1index_1_1collector_aabde926725ae445f4be1a6f54d4db1fc} 
\index{pip.\_internal.index.collector@{pip.\_internal.index.collector}!\_match\_vcs\_scheme@{\_match\_vcs\_scheme}}
\index{\_match\_vcs\_scheme@{\_match\_vcs\_scheme}!pip.\_internal.index.collector@{pip.\_internal.index.collector}}
\doxysubsubsection{\texorpdfstring{\_match\_vcs\_scheme()}{\_match\_vcs\_scheme()}}
{\footnotesize\ttfamily  Optional\mbox{[}str\mbox{]} \+\_\+match\+\_\+vcs\+\_\+scheme (\begin{DoxyParamCaption}\item[{str}]{url }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Look for VCS schemes in the URL.

Returns the matched VCS scheme, or None if there's no match.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{collector_8py_source_l00055}{55}} of file \mbox{\hyperlink{collector_8py_source}{collector.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00055\ \textcolor{keyword}{def\ }\_match\_vcs\_scheme(url:\ str)\ -\/>\ Optional[str]:}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Look\ for\ VCS\ schemes\ in\ the\ URL.}}
\DoxyCodeLine{00057\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00058\ \textcolor{stringliteral}{\ \ \ \ Returns\ the\ matched\ VCS\ scheme,\ or\ None\ if\ there's\ no\ match.}}
\DoxyCodeLine{00059\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordflow}{for}\ scheme\ \textcolor{keywordflow}{in}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{vcs.schemes}}:}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{url.lower}}().\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{startswith}}(scheme)\ \textcolor{keywordflow}{and}\ url[\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{len}}(scheme)]\ \textcolor{keywordflow}{in}\ \textcolor{stringliteral}{"{}+:"{}}:}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ scheme}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ }

\end{DoxyCode}


References \mbox{\hyperlink{prime__search_8m_source_l00010}{i}}.



Referenced by \mbox{\hyperlink{collector_8py_source_l00336}{pip.\+\_\+internal.\+index.\+collector.\+\_\+get\+\_\+index\+\_\+content()}}.

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/def/namespacepip_1_1__internal_1_1index_1_1collector_aabde926725ae445f4be1a6f54d4db1fc_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacepip_1_1__internal_1_1index_1_1collector_a56d5215ace05d08c82d3ceeb2697280c}\label{namespacepip_1_1__internal_1_1index_1_1collector_a56d5215ace05d08c82d3ceeb2697280c} 
\index{pip.\_internal.index.collector@{pip.\_internal.index.collector}!parse\_links@{parse\_links}}
\index{parse\_links@{parse\_links}!pip.\_internal.index.collector@{pip.\_internal.index.collector}}
\doxysubsubsection{\texorpdfstring{parse\_links()}{parse\_links()}}
{\footnotesize\ttfamily  Iterable\mbox{[}\mbox{\hyperlink{classpip_1_1__internal_1_1models_1_1link_1_1Link}{Link}}\mbox{]} parse\+\_\+links (\begin{DoxyParamCaption}\item[{"{}Index\+Content"{}}]{page }\end{DoxyParamCaption})}

\begin{DoxyVerb}Parse a Simple API's Index Content, and yield its anchor elements as Link objects.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{collector_8py_source_l00229}{229}} of file \mbox{\hyperlink{collector_8py_source}{collector.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00229\ \textcolor{keyword}{def\ }parse\_links(page:\ \textcolor{stringliteral}{"{}IndexContent"{}})\ -\/>\ Iterable[Link]:}
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00231\ \textcolor{stringliteral}{\ \ \ \ Parse\ a\ Simple\ API's\ Index\ Content,\ and\ yield\ its\ anchor\ elements\ as\ Link\ objects.}}
\DoxyCodeLine{00232\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ content\_type\_l\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{page.content\_type.lower}}()}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{content\_type\_l.startswith}}(\textcolor{stringliteral}{"{}application/vnd.pypi.simple.v1+json"{}}):}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ data\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{json.loads}}(\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{page.content}})}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ file\ \textcolor{keywordflow}{in}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{data.get}}(\textcolor{stringliteral}{"{}files"{}},\ []):}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ link\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{Link.from\_json}}(file,\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{page.url}})}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ link\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ link}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \ \ \ \ parser\ =\ HTMLLinkParser(\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{page.url}})}
\DoxyCodeLine{00245\ \ \ \ \ encoding\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{page.encoding}}\ \textcolor{keywordflow}{or}\ \textcolor{stringliteral}{"{}utf-\/8"{}}}
\DoxyCodeLine{00246\ \ \ \ \ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{parser.feed}}(\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{page.content.decode}}(encoding))}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \ \ url\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{page.url}}}
\DoxyCodeLine{00249\ \ \ \ \ base\_url\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{parser.base\_url}}\ \textcolor{keywordflow}{or}\ url}
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{keywordflow}{for}\ anchor\ \textcolor{keywordflow}{in}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{parser.anchors}}:}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ link\ =\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{Link.from\_element}}(anchor,\ page\_url=url,\ base\_url=base\_url)}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ link\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ link}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ }

\end{DoxyCode}


References \mbox{\hyperlink{prime__search_8m_source_l00010}{i}}.

\Hypertarget{namespacepip_1_1__internal_1_1index_1_1collector_acc51c183456bf01f6547d990d383db94}\label{namespacepip_1_1__internal_1_1index_1_1collector_acc51c183456bf01f6547d990d383db94} 
\index{pip.\_internal.index.collector@{pip.\_internal.index.collector}!with\_cached\_index\_content@{with\_cached\_index\_content}}
\index{with\_cached\_index\_content@{with\_cached\_index\_content}!pip.\_internal.index.collector@{pip.\_internal.index.collector}}
\doxysubsubsection{\texorpdfstring{with\_cached\_index\_content()}{with\_cached\_index\_content()}}
{\footnotesize\ttfamily  \mbox{\hyperlink{classpip_1_1__internal_1_1index_1_1collector_1_1ParseLinks}{Parse\+Links}} with\+\_\+cached\+\_\+index\+\_\+content (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classpip_1_1__internal_1_1index_1_1collector_1_1ParseLinks}{Parse\+Links}}}]{fn }\end{DoxyParamCaption})}

\begin{DoxyVerb}Given a function that parses an Iterable[Link] from an IndexContent, cache the
function's result (keyed by CacheablePageContent), unless the IndexContent
`page` has `page.cache_link_parsing == False`.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{collector_8py_source_l00208}{208}} of file \mbox{\hyperlink{collector_8py_source}{collector.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00208\ \textcolor{keyword}{def\ }with\_cached\_index\_content(fn:\ ParseLinks)\ -\/>\ ParseLinks:}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00210\ \textcolor{stringliteral}{\ \ \ \ Given\ a\ function\ that\ parses\ an\ Iterable[Link]\ from\ an\ IndexContent,\ cache\ the}}
\DoxyCodeLine{00211\ \textcolor{stringliteral}{\ \ \ \ function's\ result\ (keyed\ by\ CacheablePageContent),\ unless\ the\ IndexContent}}
\DoxyCodeLine{00212\ \textcolor{stringliteral}{\ \ \ \ \`{}page\`{}\ has\ \`{}page.cache\_link\_parsing\ ==\ False\`{}.}}
\DoxyCodeLine{00213\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \ \ \ \ \textcolor{preprocessor}{@functools.lru\_cache(maxsize=None)}}
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keyword}{def\ }wrapper(cacheable\_page:\ CacheablePageContent)\ -\/>\ List[Link]:}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ list(fn(\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{cacheable\_page.page}}))}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{preprocessor}{@functools.wraps(fn)}}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{wrapper\_wrapper}}(page:\ \textcolor{stringliteral}{"{}IndexContent"{}})\ -\/>\ List[Link]:}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{prime__search_8m_a6f6ccfcf58b31cb6412107d9d5281426}{page.cache\_link\_parsing}}:}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ wrapper(CacheablePageContent(page))}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ list(fn(page))}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keywordflow}{return}\ wrapper\_wrapper}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \textcolor{preprocessor}{@with\_cached\_index\_content}}

\end{DoxyCode}


References \mbox{\hyperlink{prime__search_8m_source_l00010}{i}}.



\doxysubsection{Variable Documentation}
\Hypertarget{namespacepip_1_1__internal_1_1index_1_1collector_a0b14e488ae28d98d262453f3e9cd6e4d}\label{namespacepip_1_1__internal_1_1index_1_1collector_a0b14e488ae28d98d262453f3e9cd6e4d} 
\index{pip.\_internal.index.collector@{pip.\_internal.index.collector}!logger@{logger}}
\index{logger@{logger}!pip.\_internal.index.collector@{pip.\_internal.index.collector}}
\doxysubsubsection{\texorpdfstring{logger}{logger}}
{\footnotesize\ttfamily logger = logging.\+get\+Logger(\+\_\+\+\_\+name\+\_\+\+\_\+)}



Definition at line \mbox{\hyperlink{collector_8py_source_l00050}{50}} of file \mbox{\hyperlink{collector_8py_source}{collector.\+py}}.

\Hypertarget{namespacepip_1_1__internal_1_1index_1_1collector_aac39b55be6469395f55ff0292ad8184c}\label{namespacepip_1_1__internal_1_1index_1_1collector_aac39b55be6469395f55ff0292ad8184c} 
\index{pip.\_internal.index.collector@{pip.\_internal.index.collector}!Protocol@{Protocol}}
\index{Protocol@{Protocol}!pip.\_internal.index.collector@{pip.\_internal.index.collector}}
\doxysubsubsection{\texorpdfstring{Protocol}{Protocol}}
{\footnotesize\ttfamily Protocol = object}



Definition at line \mbox{\hyperlink{collector_8py_source_l00048}{48}} of file \mbox{\hyperlink{collector_8py_source}{collector.\+py}}.

\Hypertarget{namespacepip_1_1__internal_1_1index_1_1collector_acc8011d409502c4a78917f6308db8bdd}\label{namespacepip_1_1__internal_1_1index_1_1collector_acc8011d409502c4a78917f6308db8bdd} 
\index{pip.\_internal.index.collector@{pip.\_internal.index.collector}!ResponseHeaders@{ResponseHeaders}}
\index{ResponseHeaders@{ResponseHeaders}!pip.\_internal.index.collector@{pip.\_internal.index.collector}}
\doxysubsubsection{\texorpdfstring{ResponseHeaders}{ResponseHeaders}}
{\footnotesize\ttfamily Response\+Headers = Mutable\+Mapping\mbox{[}str, str\mbox{]}}



Definition at line \mbox{\hyperlink{collector_8py_source_l00052}{52}} of file \mbox{\hyperlink{collector_8py_source}{collector.\+py}}.

