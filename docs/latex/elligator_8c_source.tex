\doxysection{elligator.\+c}
\hypertarget{elligator_8c_source}{}\label{elligator_8c_source}\index{C:/Users/liwuen/Desktop/Doxygen local test/pqc-\/engineering-\/ssec-\/23/dCTIDH/src/common/elligator.c@{C:/Users/liwuen/Desktop/Doxygen local test/pqc-\/engineering-\/ssec-\/23/dCTIDH/src/common/elligator.c}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00001}00001\ \textcolor{comment}{//\ \#include\ "{}crypto\_declassify.h"{}}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00002}00002\ \textcolor{preprocessor}{\#include\ "{}elligator.h"{}}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00004}00004\ \textcolor{comment}{//\ \#define\ fp\_cswap\ fp\_cswap\_ctidh}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00005}00005\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00006}00006\ \textcolor{keywordtype}{void}\ elligator(\mbox{\hyperlink{structproj}{proj}}\ *plus,\mbox{\hyperlink{structproj}{proj}}\ *minus,\textcolor{keyword}{const}\ \mbox{\hyperlink{structproj}{proj}}\ *A)}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00007}00007\ \{}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00008}00008\ \ \ \textcolor{keywordflow}{for}\ (;;)\ \{}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00009}00009\ \ \ \ \ fp\ u;}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00010}00010\ \ \ \ \ fp\_random(u);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00011}00011\ \ \ \ \ \textcolor{comment}{//\ memset(u,\ 1,\ sizeof(u));\ }}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00012}00012\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00013}00013\ \ \ \ \ \textcolor{comment}{//\ long\ long\ reject\ =\ fp\_iszero(\&u);}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00014}00014\ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ reject\ =\ fp\_iszero(u);\ \ \ \ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00015}00015\ \ \ \ \ \textcolor{comment}{//\ crypto\_declassify(\&reject,sizeof\ reject);}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00016}00016\ \ \ \ \ \textcolor{keywordflow}{if}\ (reject)\ \textcolor{keywordflow}{continue};\ \textcolor{comment}{/*\ bad\ RNG\ outputs\ 0\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00018}00018\ \ \ \ \ fp\ u2;\ fp\_sq2(\&u2,(\textcolor{keyword}{const}\ fp*)\ \&u);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00019}00019\ \ \ \ \ fp\ D\ =\ \{0\};\ fp\_sub3(\&D,(\textcolor{keyword}{const}\ fp*)\ \&u2,\&fp\_1);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00020}00020\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00021}00021\ \ \ \ \ \textcolor{comment}{//\ reject\ =\ fp\_iszero(\&D);}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00022}00022\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00023}00023\ \ \ \ \ reject\ =\ fp\_iszero(D);\ \ \ \ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00024}00024\ \ \ \ \ \textcolor{comment}{//\ crypto\_declassify(\&reject,sizeof\ reject);}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00025}00025\ \ \ \ \ \textcolor{keywordflow}{if}\ (reject)\ \textcolor{keywordflow}{continue};\ \textcolor{comment}{/*\ bad\ RNG\ outputs\ +-\/1\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00026}00026\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00027}00027\ \ \ \ \ fp\ M;\ fp\_mul3(\&M,\&A-\/>x,(\textcolor{keyword}{const}\ fp*)\ \&u2);\ \textcolor{comment}{/*\ M\ =\ u\string^2\ A-\/>x\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00028}00028\ \ \ \ \ fp\ T;\ fp\_mul3(\&T,\&A-\/>x,(\textcolor{keyword}{const}\ fp*)\ \&M);\ \textcolor{comment}{/*\ T\ =\ u\string^2\ A-\/>x\string^2\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00029}00029\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00030}00030\ \ \ \ \ \textcolor{comment}{//\ long\ long\ control\ =\ fp\_iszero(\&A-\/>x);}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00031}00031\ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ control\ =\ fp\_iszero(A-\/>x);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00032}00032\ \ \ \ \ fp\ P;}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00033}00033\ \ \ \ \ fp\_copy(P,\ A-\/>x);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00034}00034\ \ \ \ \ fp\_cmov\_ctidh(\&P,\&fp\_1,control);\ \textcolor{comment}{/*\ P\ =\ 1\ if\ A-\/>x\ =\ 0\ else\ A-\/>x\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00035}00035\ \ \ \ \ fp\_cmov\_ctidh(\&M,\&fp\_1,control);\ \textcolor{comment}{/*\ M\ =\ 1\ if\ A-\/>x\ =\ 0\ else\ u\string^2\ A-\/>x\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00036}00036\ \ \ \ \ fp\_cmov\_ctidh(\&T,\&fp\_1,control);\ \textcolor{comment}{/*\ T\ =\ 1\ if\ A-\/>x\ =\ 0\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00038}00038\ \ \ \ \ fp\_mul2(\&D,\&A-\/>z);\ \textcolor{comment}{/*\ D\ =\ (u\string^2-\/1)\ A-\/>z\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00039}00039\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00040}00040\ \ \ \ \ fp\ D2;\ fp\_sq2(\&D2,(\textcolor{keyword}{const}\ fp*)\ \&D);\ \textcolor{comment}{/*\ D2\ =\ (u\string^2-\/1)\string^2\ A-\/>z\string^2\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00041}00041\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00042}00042\ \ \ \ \ fp\_add2(\&T,(\textcolor{keyword}{const}\ fp*)\ \&D2);\ \textcolor{comment}{/*\ T\ =\ 1\ +\ (u\string^2-\/1)\string^2\ A-\/>z\string^2\ if\ A-\/>x\ =\ 0,\ else\ u\string^2\ A-\/>x\string^2\ +\ (u\string^2-\/1)\string^2\ A-\/>z\string^2\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00043}00043\ \ \ \ \ fp\_mul2(\&T,(\textcolor{keyword}{const}\ fp*)\ \&D);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00044}00044\ \ \ \ \ fp\_mul2(\&T,(\textcolor{keyword}{const}\ fp*)\ \&P);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00045}00045\ \ \ \ \ \textcolor{comment}{/*\ T\ =\ (u\string^2-\/1)A-\/>z(1+(u\string^2-\/1)\string^2\ A-\/>z\string^2)\ if\ A-\/>x\ =\ 0\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00046}00046\ \ \ \ \ \textcolor{comment}{/*\ else\ (u\string^2-\/1)\ A-\/>z\ A-\/>x(u\string^2\ A-\/>x\string^2\ +\ (u\string^2-\/1)\string^2\ A-\/>z\string^2)\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00047}00047\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00048}00048\ \ \ \ \ \textcolor{comment}{/*\ plus\ point\ will\ be\ P/D\ =\ 1/(u\string^2-\/1)A-\/>z\ if\ A-\/>x\ =\ 0\ else\ A/(u\string^2-\/1)\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00049}00049\ \ \ \ \ \textcolor{comment}{/*\ and\ minus\ point\ will\ be\ -\/M/D\ =\ -\/1/(u\string^2-\/1)A-\/>z\ if\ A-\/>x\ =\ 0\ else\ -\/u\string^2\ A/(u\string^2-\/1)\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00050}00050\ \ \ \ \ \textcolor{comment}{/*\ unless\ they're\ flipped,\ which\ is\ determined\ by\ T\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00051}00051\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00052}00052\ \ \ \ \ \textcolor{comment}{/*\ T\ =\ Az\string^4\ (1-\/u\string^2)\string^4\ ((P/D)\string^3+A(P/D)\string^2+(P/D))\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00053}00053\ \ \ \ \ \textcolor{comment}{/*\ so\ T\ squareness\ says\ whether\ P/D\ is\ on\ curve\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00054}00054\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00055}00055\ \ \ \ \ \textcolor{comment}{/*\ also\ says\ whether\ -\/M/D\ is\ not\ on\ curve:\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00056}00056\ \ \ \ \ \textcolor{comment}{/*\ in\ all\ cases\ -\/M/D\ =\ -\/P/D-\/A\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00057}00057\ \ \ \ \ \textcolor{comment}{/*\ so\ (-\/M/D)\string^3+A(-\/M/D)\string^2+(-\/M/D)\ =\ (-\/P/D-\/A)\string^3+A(-\/P/D-\/A)\string^2+(-\/P/D-\/A)\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00058}00058\ \ \ \ \ \textcolor{comment}{/*\ =\ ((P/D)\string^3+A(P/D)\string^2+(P/D))\ (-\/1-\/AD/P)\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00059}00059\ \ \ \ \ \textcolor{comment}{/*\ and\ by\ construction\ -\/1-\/AD/P\ is\ a\ non-\/square\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00060}00060\ \ \ \ \ \textcolor{comment}{/*\ since\ it's\ -\/1\ if\ A=0,\ else\ -\/u\string^2\ */}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00061}00061\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00062}00062\ \ \ \ \ fp\_copy(plus-\/>x,\ P);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00063}00063\ \ \ \ \ fp\_neg2(\&minus-\/>x,(\textcolor{keyword}{const}\ fp*)\ \&M);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00064}00064\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00066}00066\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00067}00067\ \textcolor{comment}{//\ \ \ x0\ =\ plus-\/>x;}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00068}00068\ \textcolor{comment}{//\ \ \ y0\ =\ minus-\/>x;}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00069}00069\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00070}00070\ \ \ \ \ \textcolor{comment}{//\ test\ x0,\ y0;}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00071}00071\ \ \ \ \ \textcolor{comment}{//\ x0[0]\ =\ 1;}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00072}00072\ \ \ \ \ \textcolor{comment}{//\ y0[0]\ =\ 2;}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00073}00073\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00074}00074\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00075}00075\ \ \ \ \ fp\_cswap(plus-\/>x,minus-\/>x,1-\/fp\_sqrt(\&T));}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00076}00076\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00077}00077\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00078}00078\ \ \ \ \ fp\_copy(plus-\/>z,\ D);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00079}00079\ \ \ \ \ fp\_copy(minus-\/>z,\ D);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00080}00080\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00081}00081\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00082}00082\ \ \ \}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00083}00083\ \}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00084}00084\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00085}00085\ \textcolor{comment}{//\ Computes\ elligator\ for\ fixed\ seed\ u}}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00086}00086\ \textcolor{keywordtype}{void}\ elligator\_seeded(\mbox{\hyperlink{structproj}{proj}}\ *Tp,\ \mbox{\hyperlink{structproj}{proj}}\ *Tm,\ \mbox{\hyperlink{structproj}{proj}}\ \textcolor{keyword}{const}\ *A,\ fp\ \textcolor{keyword}{const}\ *u)}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00087}00087\ \{}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00088}00088\ \ \ \ \ fp\ Ap,\ C\_times\_u\_squared\_minus\_one,\ AC\_times\_u\_squared\_minus\_one,}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00089}00089\ \ \ \ \ \ \ \ u\_squared,\ u\_squared\_plus\_one,\ u\_squared\_minus\_one,}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00090}00090\ \ \ \ \ \ \ \ alpha,\ beta,\ tmp,\ aux;}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00091}00091\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00092}00092\ \ \ \ \ fp\_add(Ap,\ A-\/>x,\ A-\/>x);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00093}00093\ \ \ \ \ fp\_sub(Ap,\ Ap,\ A-\/>z);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00094}00094\ \ \ \ \ fp\_add(Ap,\ Ap,\ Ap);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00095}00095\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00096}00096\ \ \ \ \ fp\_sqr(u\_squared,\ *u);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00097}00097\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00098}00098\ \ \ \ \ fp\_add(u\_squared\_plus\_one,\ u\_squared,\ fp\_1);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00099}00099\ \ \ \ \ fp\_sub(u\_squared\_minus\_one,\ u\_squared,\ fp\_1);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00100}00100\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00101}00101\ \ \ \ \ fp\_mul(C\_times\_u\_squared\_minus\_one,\ A-\/>z,\ u\_squared\_minus\_one);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00102}00102\ \ \ \ \ fp\_mul(AC\_times\_u\_squared\_minus\_one,\ Ap,\ C\_times\_u\_squared\_minus\_one);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00103}00103\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00104}00104\ \ \ \ \ fp\_sqr(tmp,\ Ap);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00105}00105\ \ \ \ \ fp\_mul(tmp,\ tmp,\ u\_squared);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00106}00106\ \ \ \ \ fp\_sqr(aux,\ C\_times\_u\_squared\_minus\_one);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00107}00107\ \ \ \ \ fp\_add(tmp,\ tmp,\ aux);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00108}00108\ \ \ \ \ fp\_mul(tmp,\ AC\_times\_u\_squared\_minus\_one,\ tmp);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00109}00109\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00110}00110\ \ \ \ \ fp\_set0(alpha);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00111}00111\ \ \ \ \ fp\_copy(beta,\ *u);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00112}00112\ \ \ \ \ fp\_cswap(alpha,\ beta,\ fp\_iszero(tmp));}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00113}00113\ \ \ \ \ fp\_mul(u\_squared\_plus\_one,\ alpha,\ u\_squared\_plus\_one);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00114}00114\ \ \ \ \ fp\_mul(alpha,\ alpha,\ C\_times\_u\_squared\_minus\_one);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00115}00115\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00116}00116\ \ \ \ \ fp\_add(Tp-\/>x,\ Ap,\ alpha);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00117}00117\ \ \ \ \ fp\_mul(Tm-\/>x,\ Ap,\ u\_squared);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00118}00118\ \ \ \ \ fp\_add(Tm-\/>x,\ Tm-\/>x,\ alpha);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00119}00119\ \ \ \ \ fp\_sub(Tm-\/>x,\ fp\_0,\ Tm-\/>x);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00120}00120\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00121}00121\ \ \ \ \ fp\_add(tmp,\ tmp,\ u\_squared\_plus\_one);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00122}00122\ \ \ \ \ fp\_cswap(Tp-\/>x,\ Tm-\/>x,\ 1\ -\/\ fp\_issquare(tmp));}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00123}00123\ }
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00124}00124\ \ \ \ \ fp\_copy(Tp-\/>z,\ C\_times\_u\_squared\_minus\_one);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00125}00125\ \ \ \ \ fp\_copy(Tm-\/>z,\ C\_times\_u\_squared\_minus\_one);}
\DoxyCodeLine{\Hypertarget{elligator_8c_source_l00126}00126\ \}}

\end{DoxyCode}
