\doxysection{E\+:/pqc-\/engineering-\/ssec-\/23/d\+CTIDH/src/\+CTIDH/ctidh\+\_\+wombat\+\_\+eval.c File Reference}
\hypertarget{ctidh__wombat__eval_8c}{}\label{ctidh__wombat__eval_8c}\index{E:/pqc-\/engineering-\/ssec-\/23/dCTIDH/src/CTIDH/ctidh\_wombat\_eval.c@{E:/pqc-\/engineering-\/ssec-\/23/dCTIDH/src/CTIDH/ctidh\_wombat\_eval.c}}
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$assert.\+h$>$}\newline
{\ttfamily \#include "{}ctidh.\+h"{}}\newline
{\ttfamily \#include "{}../common/primes.\+h"{}}\newline
{\ttfamily \#include "{}../common/int64mask.\+h"{}}\newline
{\ttfamily \#include "{}../common/elligator.\+h"{}}\newline
{\ttfamily \#include "{}../common/random.\+h"{}}\newline
Include dependency graph for ctidh\+\_\+wombat\+\_\+eval.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/de3/ctidh__wombat__eval_8c__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{ctidh__wombat__eval_8c_ad6eaa6451c6422920550bf06f4169b6d}{fulltorsion\+\_\+points}} (\mbox{\hyperlink{fp-gmp_8h_a167c68a20b94476341fdbff3d8688784}{fp}} u, \mbox{\hyperlink{fp-gmp_8h_a167c68a20b94476341fdbff3d8688784}{fp}} const \mbox{\hyperlink{to__model_8m_ae72ab0a319852f0c6d43e6937c1063bd}{a}})
\item 
void \mbox{\hyperlink{ctidh__wombat__eval_8c_a3d7a2d4a7501eca430997c1af6984de8}{action}} (\mbox{\hyperlink{structpublic__key}{public\+\_\+key}} \texorpdfstring{$\ast$}{*}out, \mbox{\hyperlink{structpublic__key}{public\+\_\+key}} const \texorpdfstring{$\ast$}{*}in, \mbox{\hyperlink{structprivate__key}{private\+\_\+key}} const \texorpdfstring{$\ast$}{*}priv)
\item 
bool \mbox{\hyperlink{ctidh__wombat__eval_8c_a16c24b59d32ee85588cc61c9770e378b}{csidh}} (\mbox{\hyperlink{structpublic__key}{public\+\_\+key}} \texorpdfstring{$\ast$}{*}out, \mbox{\hyperlink{structpublic__key}{public\+\_\+key}} const \texorpdfstring{$\ast$}{*}in, \mbox{\hyperlink{structprivate__key}{private\+\_\+key}} const \texorpdfstring{$\ast$}{*}priv)
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const \mbox{\hyperlink{structpublic__key}{public\+\_\+key}} \mbox{\hyperlink{ctidh__wombat__eval_8c_ae5a97e9debf3707d97dfb35dc631a0ca}{base}} = \{.A = \{0\}, .seed = ELLIGATOR\+\_\+\+SEED\}
\end{DoxyCompactItemize}


\label{doc-func-members}
\Hypertarget{ctidh__wombat__eval_8c_doc-func-members}
\doxysubsection{Function Documentation}
\Hypertarget{ctidh__wombat__eval_8c_a3d7a2d4a7501eca430997c1af6984de8}\index{ctidh\_wombat\_eval.c@{ctidh\_wombat\_eval.c}!action@{action}}
\index{action@{action}!ctidh\_wombat\_eval.c@{ctidh\_wombat\_eval.c}}
\doxysubsubsection{\texorpdfstring{action()}{action()}}
{\footnotesize\ttfamily \label{ctidh__wombat__eval_8c_a3d7a2d4a7501eca430997c1af6984de8} 
void action (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structpublic__key}{public\+\_\+key}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{\mbox{\hyperlink{structpublic__key}{public\+\_\+key}} const \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{\mbox{\hyperlink{structprivate__key}{private\+\_\+key}} const \texorpdfstring{$\ast$}{*}}]{priv}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{ctidh__wombat__eval_8c_source_l00177}{177}} of file \mbox{\hyperlink{ctidh__wombat__eval_8c_source}{ctidh\+\_\+wombat\+\_\+eval.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00178\ \{}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ init\_counters();}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \mbox{\hyperlink{structproj}{proj}}\ \mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}};}
\DoxyCodeLine{00183\ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_ad0b6e5afb2fdd4f50fd2714fc59931ab}{fp\_copy}}(\mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.x,\ in-\/>A);}
\DoxyCodeLine{00184\ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_ad0b6e5afb2fdd4f50fd2714fc59931ab}{fp\_copy}}(\mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.z,\ \mbox{\hyperlink{fp-gmp_8h_a4ec3519815103a8a92bd612f933abbb1}{fp\_1}});}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \ \ \mbox{\hyperlink{structproj}{proj}}\ A24;}
\DoxyCodeLine{00187\ \ \ \ \ \mbox{\hyperlink{mont_8h_a1983214d89665bc95ea846ba0d45114b}{xA24}}(\&A24,\ \&A);}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ \mbox{\hyperlink{structproj}{proj}}\ Points[4];}
\DoxyCodeLine{00190\ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_a167c68a20b94476341fdbff3d8688784}{fp}}\ seed;}
\DoxyCodeLine{00191\ \ \ \ \ fp\_set(seed,\ in-\/>seed);}
\DoxyCodeLine{00192\ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_aa73022969fcd23d0d81d0b7115248d5d}{fp\_enc}}(seed,\ seed);}
\DoxyCodeLine{00193\ \ \ \ \ \mbox{\hyperlink{elligator_8h_ab62f777855b4aeae0423f37feb8386e2}{elligator\_seeded}}(\&Points[0],\ \&Points[1],\ \&A24,\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{fp-gmp_8h_a167c68a20b94476341fdbff3d8688784}{fp}}\ *)seed);}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \ \ clearpublicprimes(\&Points[0],\ \&A24);}
\DoxyCodeLine{00196\ \ \ \ \ clearpublicprimes(\&Points[1],\ \&A24);}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{comment}{//\ clear\ ells\ not\ used\ in\ the\ keyspace}}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keywordflow}{for}\ (int16\_t\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ \mbox{\hyperlink{primes_8h_acc9e03579591509b3edb49d07bc8cca6}{batch\_stop}}[primes\_batches\ -\/\ 1]\ +\ 1;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ primes\_num;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}++)}
\DoxyCodeLine{00200\ \ \ \ \ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_a33bcb2a867a845121bac1591c68456d1}{xMUL\_dac}}(\&Points[0],\ \&A24,\ 0,\ \&Points[0],\ \mbox{\hyperlink{primes_8h_a56cb00c68833427c91926115f0eb70f0}{primes\_dac}}[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}],\ \mbox{\hyperlink{primes_8h_a91122dc998b135229e3bbde3ed578d80}{primes\_daclen}}[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}],\ \mbox{\hyperlink{primes_8h_a91122dc998b135229e3bbde3ed578d80}{primes\_daclen}}[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}]);}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_a33bcb2a867a845121bac1591c68456d1}{xMUL\_dac}}(\&Points[1],\ \&A24,\ 0,\ \&Points[1],\ \mbox{\hyperlink{primes_8h_a56cb00c68833427c91926115f0eb70f0}{primes\_dac}}[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}],\ \mbox{\hyperlink{primes_8h_a91122dc998b135229e3bbde3ed578d80}{primes\_daclen}}[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}],\ \mbox{\hyperlink{primes_8h_a91122dc998b135229e3bbde3ed578d80}{primes\_daclen}}[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}]);}
\DoxyCodeLine{00203\ \ \ \ \ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{comment}{//\ collect\ primes\ not\ used\ in\ the\ key\ ...}}
\DoxyCodeLine{00206\ \ \ \ \ int16\_t\ unused[\mbox{\hyperlink{primes_8h_acc9e03579591509b3edb49d07bc8cca6}{batch\_stop}}[primes\_batches\ -\/\ 1]\ +\ 1];}
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{comment}{//\ int16\_t\ unused[255]\ =\ \{0\};}}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \ \ \ \ int16\_t\ u\ =\ 0;}
\DoxyCodeLine{00210\ \ \ \ \ int16\_t\ e\ =\ 0;}
\DoxyCodeLine{00211\ \ \ \ \ int16\_t\ w\ =\ 0;}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keywordflow}{for}\ (e\ =\ 0;\ e\ <=\ \mbox{\hyperlink{primes_8h_acc9e03579591509b3edb49d07bc8cca6}{batch\_stop}}[primes\_batches\ -\/\ 1];\ e++)}
\DoxyCodeLine{00213\ \ \ \ \ \{}
\DoxyCodeLine{00214\ \textcolor{preprocessor}{\#ifdef\ ENABLE\_CT\_TESTING}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ VALGRIND\_MAKE\_MEM\_DEFINED(\&u,\ \textcolor{keyword}{sizeof}(int16\_t));}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ VALGRIND\_MAKE\_MEM\_DEFINED(\&e,\ \textcolor{keyword}{sizeof}(int16\_t));}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ VALGRIND\_MAKE\_MEM\_DEFINED(\&w,\ \textcolor{keyword}{sizeof}(int16\_t));}
\DoxyCodeLine{00218\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ unused[u]\ =\ e;}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ int64\_t\ mov\ =\ -\/int64mask\_equal((int64\_t)e,\ (int64\_t)priv-\/>ells[w]);}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_a167c68a20b94476341fdbff3d8688784}{fp}}\ t1,\ t2;}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ t1[0]\ =\ u;}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ t2[0]\ =\ u\ +\ 1;}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_a5324909527d54f9d1ec902b743b5133c}{fp\_cmov}}(\&t1,\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{fp-gmp_8h_a167c68a20b94476341fdbff3d8688784}{fp}}\ *)\&t2,\ 1\ -\/\ mov);}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ u\ =\ t1[0];}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ t1[0]\ =\ w;}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ t2[0]\ =\ w\ +\ 1;}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_a5324909527d54f9d1ec902b743b5133c}{fp\_cmov}}(\&t1,\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{fp-gmp_8h_a167c68a20b94476341fdbff3d8688784}{fp}}\ *)\&t2,\ mov);}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ w\ =\ t1[0];}
\DoxyCodeLine{00234\ \ \ \ \ \}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{comment}{//\ ...\ and\ remove\ them\ from\ our\ points}}
\DoxyCodeLine{00237\ \ \ \ \ int16\_t\ tmp\_b\ =\ 0;}
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{keywordflow}{for}\ (u\ =\ 0;\ u\ <=\ \mbox{\hyperlink{primes_8h_acc9e03579591509b3edb49d07bc8cca6}{batch\_stop}}[primes\_batches\ -\/\ 1]\ -\/\ WOMBATKEYS;\ u++)}
\DoxyCodeLine{00239\ \ \ \ \ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ int16\_t\ t\ =\ unused[u];}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t\ >\ \mbox{\hyperlink{primes_8h_acc9e03579591509b3edb49d07bc8cca6}{batch\_stop}}[tmp\_b])}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \ \ tmp\_b++;}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ dac\ =\ lookup(t,\ \mbox{\hyperlink{primes_8h_a56cb00c68833427c91926115f0eb70f0}{primes\_dac}});}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ daclen\ =\ lookup(t,\ \mbox{\hyperlink{primes_8h_a91122dc998b135229e3bbde3ed578d80}{primes\_daclen}});}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_a33bcb2a867a845121bac1591c68456d1}{xMUL\_dac}}(\&Points[0],\ \&A24,\ 0,\ \&Points[0],\ dac,\ daclen,\ \mbox{\hyperlink{primes_8h_a258b7d004311e956a8eac8954d5d184d}{batch\_maxdac}}[tmp\_b]);}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_a33bcb2a867a845121bac1591c68456d1}{xMUL\_dac}}(\&Points[1],\ \&A24,\ 0,\ \&Points[1],\ dac,\ daclen,\ \mbox{\hyperlink{primes_8h_a258b7d004311e956a8eac8954d5d184d}{batch\_maxdac}}[tmp\_b]);}
\DoxyCodeLine{00249\ \ \ \ \ \}}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ \ \ \ \ \textcolor{comment}{//\ ACTION!}}
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{comment}{//\ copy\ "{}outer"{}\ points}}
\DoxyCodeLine{00253\ \ \ \ \ proj\_copy(\&Points[2],\ \&Points[0]);}
\DoxyCodeLine{00254\ \ \ \ \ proj\_copy(\&Points[3],\ \&Points[1]);}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \ \ int16\_t\ current\_key\ =\ WOMBATKEYS\ -\/\ 1;}
\DoxyCodeLine{00257\ \ \ \ \ \textcolor{keywordflow}{for}\ (int16\_t\ current\_batch\ =\ primes\_batches\ -\/\ 1;\ current\_batch\ >=\ 0;\ current\_batch-\/-\/)}
\DoxyCodeLine{00258\ \ \ \ \ \{}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ uint8\_t\ inner\_counter\ =\ 0;}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ outer\ points\ are\ now\ the\ inner\ points}}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ proj\_copy(\&Points[0],\ \&Points[2]);}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ proj\_copy(\&Points[1],\ \&Points[3]);}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ remove\ degrees\ not\ in\ the\ batch}}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ tmp\_b\ =\ 0;}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int16\_t\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ 0;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ \mbox{\hyperlink{primes_8h_a0c186a4875e68bfc39a2688c42d12e26}{batch\_keybounds\_start}}[current\_batch];\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}++)}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ >\ \mbox{\hyperlink{primes_8h_a3a6da910ef8a7d99406350469d1fba82}{batch\_keybounds\_stop}}[tmp\_b])}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tmp\_b++;}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ dac\ =\ lookup(priv-\/>ells[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}],\ \mbox{\hyperlink{primes_8h_a56cb00c68833427c91926115f0eb70f0}{primes\_dac}});}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ daclen\ =\ lookup(priv-\/>ells[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}],\ \mbox{\hyperlink{primes_8h_a91122dc998b135229e3bbde3ed578d80}{primes\_daclen}});}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_a33bcb2a867a845121bac1591c68456d1}{xMUL\_dac}}(\&Points[0],\ \&A24,\ 0,\ \&Points[0],\ dac,\ daclen,\ \mbox{\hyperlink{primes_8h_a258b7d004311e956a8eac8954d5d184d}{batch\_maxdac}}[tmp\_b]);}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_a33bcb2a867a845121bac1591c68456d1}{xMUL\_dac}}(\&Points[1],\ \&A24,\ 0,\ \&Points[1],\ dac,\ daclen,\ \mbox{\hyperlink{primes_8h_a258b7d004311e956a8eac8954d5d184d}{batch\_maxdac}}[tmp\_b]);}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (;\ current\_key\ >=\ \mbox{\hyperlink{primes_8h_a0c186a4875e68bfc39a2688c42d12e26}{batch\_keybounds\_start}}[current\_batch];\ current\_key-\/-\/)}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ uint16\_t\ current\_ell\_index\ =\ priv-\/>ells[current\_key];}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ current\_ell\ =\ lookup(current\_ell\_index,\ \mbox{\hyperlink{primes_8h_a137794744a03163a524ebb2aac2105c0}{primes}});}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 0\ -\/>\ dummy,\ 1\ -\/>\ +\ direction,\ 2\ -\/>\ -\/\ direction}}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ int64\_t\ direction\ =\ priv-\/>directions[current\_key];}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ lowerend\_ell\ =\ \mbox{\hyperlink{primes_8h_a137794744a03163a524ebb2aac2105c0}{primes}}[\mbox{\hyperlink{primes_8h_a63de22a96a777bab244dd0850f58fed9}{batch\_start}}[current\_batch]\ +\ \mbox{\hyperlink{primes_8h_a950dc149fa08d10049e01546ca3562b3}{batch\_numkeys}}[current\_batch]\ -\/\ inner\_counter\ -\/\ 1];}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ upperend\_ell\ =\ \mbox{\hyperlink{primes_8h_a137794744a03163a524ebb2aac2105c0}{primes}}[\mbox{\hyperlink{primes_8h_acc9e03579591509b3edb49d07bc8cca6}{batch\_stop}}[current\_batch]\ -\/\ inner\_counter];}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ printf("{}\%3d:\ \%2d\ -\/\ \%4ld-\/isogeny\ to\ \%ld\ for\ cost\ of\ (\%4ld,\%4ld)\(\backslash\)n"{},}}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ current\_key,\ current\_batch,\ current\_ell,\ direction,\ lowerend\_ell,\ upperend\_ell);}}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ multiply\ out\ other\ factors}}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structproj}{proj}}\ K;}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ proj\_cmov(\&K,\ \&Points[0],\ -\/int64mask\_equal(direction,\ (int64\_t)2));}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ proj\_cmov(\&K,\ \&Points[1],\ 1\ +\ int64mask\_equal(direction,\ (int64\_t)2));}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ skip\ the\ "{}last/already\ processed"{}\ and\ remove\ only\ the\ "{}other"{}\ degrees}}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int16\_t\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ \mbox{\hyperlink{primes_8h_a0c186a4875e68bfc39a2688c42d12e26}{batch\_keybounds\_start}}[current\_batch];\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ \mbox{\hyperlink{primes_8h_a3a6da910ef8a7d99406350469d1fba82}{batch\_keybounds\_stop}}[current\_batch]\ -\/\ inner\_counter;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}++)}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_a33bcb2a867a845121bac1591c68456d1}{xMUL\_dac}}(\&K,\ \&A24,\ 0,\ \&K,\ lookup(priv-\/>ells[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}],\ \mbox{\hyperlink{primes_8h_a56cb00c68833427c91926115f0eb70f0}{primes\_dac}}),\ lookup(priv-\/>ells[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}],\ \mbox{\hyperlink{primes_8h_a91122dc998b135229e3bbde3ed578d80}{primes\_daclen}}),\ \mbox{\hyperlink{primes_8h_a258b7d004311e956a8eac8954d5d184d}{batch\_maxdac}}[current\_batch]);}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ make\ a\ copy\ to\ trow\ away\ in\ the\ dummy\ case}}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structproj}{proj}}\ A\_;}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structproj}{proj}}\ Points\_[4];}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \ \ \ \ proj\_copy(\&Points\_[0],\ \&Points[0]);}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \ \ \ \ proj\_copy(\&Points\_[1],\ \&Points[1]);}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \ \ \ \ proj\_copy(\&Points\_[2],\ \&Points[2]);}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \ \ \ \ proj\_copy(\&Points\_[3],\ \&Points[3]);}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \ \ \ \ proj\_copy(\&A\_,\ \&A);}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ can\ now\ compute\ the\ isogeny}}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (current\_key\ ==\ 0)}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ is\ the\ last\ isogeny\ we\ need\ to\ compute!\ so\ we\ don't\ need\ to\ push\ points}}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_ac3af9f03d84babaea6d4d2faea220ba1}{xISOG\_matryoshka}}(\&A\_,\ Points\_,\ 0,\ \&K,\ current\_ell,\ lowerend\_ell,\ upperend\_ell);}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (current\_key\ ==\ \mbox{\hyperlink{primes_8h_a0c186a4875e68bfc39a2688c42d12e26}{batch\_keybounds\_start}}[current\_batch])}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ on\ the\ last\ isogeny\ of\ the\ batch,\ we\ only\ need\ to\ push\ the\ 2\ "{}outer"{}\ points}}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_ac3af9f03d84babaea6d4d2faea220ba1}{xISOG\_matryoshka}}(\&A\_,\ \&Points\_[2],\ 2,\ \&K,\ current\_ell,\ lowerend\_ell,\ upperend\_ell);}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (current\_batch\ ==\ 0)}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ on\ the\ last\ batch,\ we\ only\ need\ the\ inner\ points}}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_ac3af9f03d84babaea6d4d2faea220ba1}{xISOG\_matryoshka}}(\&A\_,\ Points\_,\ 2,\ \&K,\ current\_ell,\ lowerend\_ell,\ upperend\_ell);}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (current\_key\ ==\ \mbox{\hyperlink{primes_8h_a0c186a4875e68bfc39a2688c42d12e26}{batch\_keybounds\_start}}[current\_batch]\ +\ 1)}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ on\ the\ second\ to\ last\ isogeny\ of\ a\ batch,\ we\ only\ need\ to\ push\ 3\ points}}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ one\ needed\ for\ the\ last\ isogeny\ of\ the\ batch\ +\ the\ two\ outer\ points}}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ proj\_cswap(\&Points\_[0],\ \&Points\_[1],\ -\/int64mask\_equal(priv-\/>directions[current\_key\ -\/\ 1],\ (int64\_t)2));}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_ac3af9f03d84babaea6d4d2faea220ba1}{xISOG\_matryoshka}}(\&A\_,\ \&Points\_[1],\ 3,\ \&K,\ current\_ell,\ lowerend\_ell,\ upperend\_ell);}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ proj\_cswap(\&Points\_[0],\ \&Points\_[1],\ -\/int64mask\_equal(priv-\/>directions[current\_key\ -\/\ 1],\ (int64\_t)2));}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_ac3af9f03d84babaea6d4d2faea220ba1}{xISOG\_matryoshka}}(\&A\_,\ Points\_,\ 4,\ \&K,\ current\_ell,\ lowerend\_ell,\ upperend\_ell);}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00339\ }
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ skip\ isogeny\ in\ case\ of\ dummy\ isog}}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \ \ \ \ proj\_cmov(\&A,\ \&A\_,\ -\/int64mask\_nonzero(direction));}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \ \ \ \ proj\_cmov(\&Points[0],\ \&Points\_[0],\ -\/int64mask\_nonzero(direction));}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ \ \ proj\_cmov(\&Points[1],\ \&Points\_[1],\ -\/int64mask\_nonzero(direction));}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ \ \ proj\_cmov(\&Points[2],\ \&Points\_[2],\ -\/int64mask\_nonzero(direction));}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ \ \ proj\_cmov(\&Points[3],\ \&Points\_[3],\ -\/int64mask\_nonzero(direction));}
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_a1983214d89665bc95ea846ba0d45114b}{xA24}}(\&A24,\ \&A);}
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ dac\ =\ lookup(current\_ell\_index,\ \mbox{\hyperlink{primes_8h_a56cb00c68833427c91926115f0eb70f0}{primes\_dac}});}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ daclen\ =\ lookup(current\_ell\_index,\ \mbox{\hyperlink{primes_8h_a91122dc998b135229e3bbde3ed578d80}{primes\_daclen}});}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ needed\ to\ remove\ the\ order\ incase\ a\ dummy\ isogeny\ was\ used}}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (current\_key\ >\ \mbox{\hyperlink{primes_8h_a0c186a4875e68bfc39a2688c42d12e26}{batch\_keybounds\_start}}[current\_batch])}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ not\ needed\ for\ the\ inner\ points\ in\ the\ last\ round}}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (current\_key\ ==\ \mbox{\hyperlink{primes_8h_a0c186a4875e68bfc39a2688c42d12e26}{batch\_keybounds\_start}}[current\_batch]\ +\ 1)}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ proj\_cswap(\&Points[0],\ \&Points[1],\ -\/int64mask\_equal(priv-\/>directions[current\_key\ -\/\ 1],\ (int64\_t)2));}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_a33bcb2a867a845121bac1591c68456d1}{xMUL\_dac}}(\&Points[1],\ \&A24,\ 0,\ \&Points[1],\ dac,\ daclen,\ \mbox{\hyperlink{primes_8h_a258b7d004311e956a8eac8954d5d184d}{batch\_maxdac}}[current\_batch]);}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ proj\_cswap(\&Points[0],\ \&Points[1],\ -\/int64mask\_equal(priv-\/>directions[current\_key\ -\/\ 1],\ (int64\_t)2));}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_a33bcb2a867a845121bac1591c68456d1}{xMUL\_dac}}(\&Points[0],\ \&A24,\ 0,\ \&Points[0],\ dac,\ daclen,\ \mbox{\hyperlink{primes_8h_a258b7d004311e956a8eac8954d5d184d}{batch\_maxdac}}[current\_batch]);}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_a33bcb2a867a845121bac1591c68456d1}{xMUL\_dac}}(\&Points[1],\ \&A24,\ 0,\ \&Points[1],\ dac,\ daclen,\ \mbox{\hyperlink{primes_8h_a258b7d004311e956a8eac8954d5d184d}{batch\_maxdac}}[current\_batch]);}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (current\_batch\ !=\ 0)}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_a33bcb2a867a845121bac1591c68456d1}{xMUL\_dac}}(\&Points[2],\ \&A24,\ 0,\ \&Points[2],\ dac,\ daclen,\ \mbox{\hyperlink{primes_8h_a258b7d004311e956a8eac8954d5d184d}{batch\_maxdac}}[current\_batch]);}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mont_8h_a33bcb2a867a845121bac1591c68456d1}{xMUL\_dac}}(\&Points[3],\ \&A24,\ 0,\ \&Points[3],\ dac,\ daclen,\ \mbox{\hyperlink{primes_8h_a258b7d004311e956a8eac8954d5d184d}{batch\_maxdac}}[current\_batch]);}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ \ \ inner\_counter++;}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00378\ \ \ \ \ \}}
\DoxyCodeLine{00379\ }
\DoxyCodeLine{00380\ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_a4fe5cafb16f3d0021f55eca85d443683}{fp\_inv}}(\mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.z);}
\DoxyCodeLine{00381\ \ \ \ \ fp\_mul2(\&\mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.x,\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{fp-gmp_8h_a167c68a20b94476341fdbff3d8688784}{fp}}\ *)\&\mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.z);}
\DoxyCodeLine{00382\ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_ad0b6e5afb2fdd4f50fd2714fc59931ab}{fp\_copy}}(out-\/>\mbox{\hyperlink{structpublic__key_a72d8790e9a07d07ac5b6e1a33a632dc5}{A}},\ \mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.x);}
\DoxyCodeLine{00383\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{ctidh_8h_source_l00040}{public\+\_\+key\+::A}}, \mbox{\hyperlink{primes_8h_source_l00057}{batch\+\_\+keybounds\+\_\+start}}, \mbox{\hyperlink{primes_8h_source_l00058}{batch\+\_\+keybounds\+\_\+stop}}, \mbox{\hyperlink{primes_8h_source_l00060}{batch\+\_\+maxdac}}, \mbox{\hyperlink{primes_8h_source_l00059}{batch\+\_\+numkeys}}, \mbox{\hyperlink{primes_8h_source_l00055}{batch\+\_\+start}}, \mbox{\hyperlink{primes_8h_source_l00056}{batch\+\_\+stop}}, \mbox{\hyperlink{ctidh_8h_source_l00033}{private\+\_\+key\+::directions}}, \mbox{\hyperlink{elligator_8h_source_l00008}{elligator\+\_\+seeded}}, \mbox{\hyperlink{ctidh_8h_source_l00032}{private\+\_\+key\+::ells}}, \mbox{\hyperlink{fp-gmp_8h_source_l00048}{fp\+\_\+1}}, \mbox{\hyperlink{fp-gmp_8h_source_l00323}{fp\+\_\+cmov}}, \mbox{\hyperlink{fp-gmp_8h_source_l00079}{fp\+\_\+copy}}, \mbox{\hyperlink{fp-gmp_8h_source_l00055}{fp\+\_\+enc}}, \mbox{\hyperlink{fp-gmp_8h_source_l00088}{fp\+\_\+inv}}, \mbox{\hyperlink{prime__search_8m_source_l00012}{j}}, \mbox{\hyperlink{primes_8h_source_l00051}{primes}}, \mbox{\hyperlink{primes_8h_source_l00052}{primes\+\_\+dac}}, \mbox{\hyperlink{primes_8h_source_l00053}{primes\+\_\+daclen}}, \mbox{\hyperlink{ctidh_8h_source_l00041}{public\+\_\+key\+::seed}}, \mbox{\hyperlink{mont_8h_source_l00017}{x\+A24}}, \mbox{\hyperlink{mont_8h_source_l00024}{x\+ISOG\+\_\+matryoshka}}, and \mbox{\hyperlink{mont_8h_source_l00021}{x\+MUL\+\_\+dac}}.

\Hypertarget{ctidh__wombat__eval_8c_a16c24b59d32ee85588cc61c9770e378b}\index{ctidh\_wombat\_eval.c@{ctidh\_wombat\_eval.c}!csidh@{csidh}}
\index{csidh@{csidh}!ctidh\_wombat\_eval.c@{ctidh\_wombat\_eval.c}}
\doxysubsubsection{\texorpdfstring{csidh()}{csidh()}}
{\footnotesize\ttfamily \label{ctidh__wombat__eval_8c_a16c24b59d32ee85588cc61c9770e378b} 
bool csidh (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structpublic__key}{public\+\_\+key}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{\mbox{\hyperlink{structpublic__key}{public\+\_\+key}} const \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{\mbox{\hyperlink{structprivate__key}{private\+\_\+key}} const \texorpdfstring{$\ast$}{*}}]{priv}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{ctidh__wombat__eval_8c_source_l00386}{386}} of file \mbox{\hyperlink{ctidh__wombat__eval_8c_source}{ctidh\+\_\+wombat\+\_\+eval.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00387\ \{}
\DoxyCodeLine{00388\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{ctidh_8h_a2ead90c83cecd062dd9dc5229a729612}{validate}}(in))}
\DoxyCodeLine{00389\ \ \ \ \ \{}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_afe624b010306dd35023fcd3ccbcf3378}{fp\_random}}(out-\/>\mbox{\hyperlink{structpublic__key_a72d8790e9a07d07ac5b6e1a33a632dc5}{A}});}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00392\ \ \ \ \ \}}
\DoxyCodeLine{00393\ \ \ \ \ \mbox{\hyperlink{ctidh_8h_a9aee97121de573073646701bc150f4b0}{action}}(out,\ in,\ priv);}
\DoxyCodeLine{00394\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00395\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{ctidh_8h_source_l00040}{public\+\_\+key\+::A}}, \mbox{\hyperlink{ctidh_8h_source_l00054}{action}}, \mbox{\hyperlink{fp-gmp_8h_source_l00085}{fp\+\_\+random}}, and \mbox{\hyperlink{ctidh_8h_source_l00053}{validate}}.

\Hypertarget{ctidh__wombat__eval_8c_ad6eaa6451c6422920550bf06f4169b6d}\index{ctidh\_wombat\_eval.c@{ctidh\_wombat\_eval.c}!fulltorsion\_points@{fulltorsion\_points}}
\index{fulltorsion\_points@{fulltorsion\_points}!ctidh\_wombat\_eval.c@{ctidh\_wombat\_eval.c}}
\doxysubsubsection{\texorpdfstring{fulltorsion\_points()}{fulltorsion\_points()}}
{\footnotesize\ttfamily \label{ctidh__wombat__eval_8c_ad6eaa6451c6422920550bf06f4169b6d} 
void fulltorsion\+\_\+points (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{fp-gmp_8h_a167c68a20b94476341fdbff3d8688784}{fp}}}]{u}{, }\item[{\mbox{\hyperlink{fp-gmp_8h_a167c68a20b94476341fdbff3d8688784}{fp}} const}]{a}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{ctidh__wombat__eval_8c_source_l00094}{94}} of file \mbox{\hyperlink{ctidh__wombat__eval_8c_source}{ctidh\+\_\+wombat\+\_\+eval.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00095\ \{}
\DoxyCodeLine{00096\ \ \ \ \ \mbox{\hyperlink{structproj}{proj}}\ Tp,\ Tm,\ Pp[primes\_num],\ Aux\_Tp[3],\ Pm[primes\_num],\ Aux\_Tm[3],\ \mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}};}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}};}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{comment}{//\ Convert\ curve\ to\ projective\ Montgomery\ form\ (A'\ +\ 2C\ :\ 4C)}}
\DoxyCodeLine{00100\ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_ad0b6e5afb2fdd4f50fd2714fc59931ab}{fp\_copy}}(\mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.x,\ \mbox{\hyperlink{to__model_8m_ae72ab0a319852f0c6d43e6937c1063bd}{a}});}
\DoxyCodeLine{00101\ \ \ \ \ fp\_set1(\mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.z);}
\DoxyCodeLine{00102\ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_a80f123b780aa89ca8990f737ca4cb107}{fp\_add}}(\mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.z,\ \mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.z,\ \mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.z);\ \textcolor{comment}{//\ 2C}}
\DoxyCodeLine{00103\ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_a80f123b780aa89ca8990f737ca4cb107}{fp\_add}}(\mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.x,\ \mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.x,\ \mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.z);\ \textcolor{comment}{//\ A'\ +\ 2C}}
\DoxyCodeLine{00104\ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_a80f123b780aa89ca8990f737ca4cb107}{fp\_add}}(\mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.z,\ \mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.z,\ \mbox{\hyperlink{namespacetests_a3b98e2dffc6cb06a89dcb0d5c60a0206}{A}}.z);\ \textcolor{comment}{//\ 4C}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ fp\_set0(u);\ \textcolor{comment}{//\ u\ <-\/\ 0}}
\DoxyCodeLine{00107\ \ \ \ \ uint8\_t\ boolp\ =\ 0,\ boolm\ =\ 0;}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keywordflow}{do}}
\DoxyCodeLine{00110\ \ \ \ \ \{}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \textcolor{preprocessor}{\#ifdef\ ENABLE\_CT\_TESTING}}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ VALGRIND\_MAKE\_MEM\_DEFINED(Aux\_Tp,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structproj}{proj}})\ *\ 3);}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ VALGRIND\_MAKE\_MEM\_DEFINED(Aux\_Tm,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structproj}{proj}})\ *\ 3);}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ VALGRIND\_MAKE\_MEM\_DEFINED(\&A,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structproj}{proj}}));}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ VALGRIND\_MAKE\_MEM\_DEFINED(\&boolp,\ \textcolor{keyword}{sizeof}(uint8\_t));}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ VALGRIND\_MAKE\_MEM\_DEFINED(\&boolm,\ \textcolor{keyword}{sizeof}(uint8\_t));}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ VALGRIND\_MAKE\_MEM\_DEFINED(\&Tp,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structproj}{proj}}));}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ VALGRIND\_MAKE\_MEM\_DEFINED(Pp,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structproj}{proj}})\ *\ primes\_num);}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ VALGRIND\_MAKE\_MEM\_DEFINED(Pm,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structproj}{proj}})\ *\ primes\_num);}
\DoxyCodeLine{00121\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_a80f123b780aa89ca8990f737ca4cb107}{fp\_add}}(u,\ u,\ \mbox{\hyperlink{fp-gmp_8h_a4ec3519815103a8a92bd612f933abbb1}{fp\_1}});\ \textcolor{comment}{//\ u\ <-\/\ u\ +\ 1\ ...\ Recall,\ 1\ must\ be\ in\ Montgomery\ domain}}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{elligator_8h_ab62f777855b4aeae0423f37feb8386e2}{elligator\_seeded}}(\&Tp,\ \&Tm,\ \&A,\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{fp-gmp_8h_a167c68a20b94476341fdbff3d8688784}{fp}}\ *)u);}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ clearpublicprimes(\&Tp,\ \&A);}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ clearpublicprimes(\&Tm,\ \&A);}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \textcolor{preprocessor}{\#ifdef\ ENABLE\_CT\_TESTING}}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ memset(Aux\_Tp,\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structproj}{proj}})\ *\ 3);}
\DoxyCodeLine{00131\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ multiples(Aux\_Tp,\ Tp,\ A);}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fp\_iszero(Aux\_Tp[0].z)\ |\ fp\_iszero(Aux\_Tp[1].z)\ |\ fp\_iszero(Aux\_Tp[2].z))}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \textcolor{preprocessor}{\#ifdef\ ENABLE\_CT\_TESTING}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ memset(Aux\_Tm,\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structproj}{proj}})\ *\ 3);}
\DoxyCodeLine{00138\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ multiples(Aux\_Tm,\ Tm,\ A);}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fp\_iszero(Aux\_Tm[0].z)\ |\ fp\_iszero(Aux\_Tm[1].z)\ |\ fp\_iszero(Aux\_Tm[2].z))}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Checking\ if\ Tp\ is\ an\ order\ (p+1)/(2\string^e)}}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ proj\_copy(\&Pp[0],\ \&Tp);}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ctidh_8h_aef94c206880c1495cff4b5fa89212810}{cofactor\_multiples}}(Pp,\ A,\ 0,\ primes\_num);}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ boolp\ =\ 1;}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ boolp\ \&=\ (1\ -\/\ fp\_iszero(Pp[0].z))\ |\ (1\ -\/\ fp\_iszero(Aux\_Tp[0].z));}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ boolp\ \&=\ (1\ -\/\ fp\_iszero(Pp[1].z))\ |\ (1\ -\/\ fp\_iszero(Aux\_Tp[1].z));}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ boolp\ \&=\ (1\ -\/\ fp\_iszero(Pp[2].z))\ |\ (1\ -\/\ fp\_iszero(Aux\_Tp[2].z));}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ 3;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ (int)primes\_num;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}++)}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ boolp\ \&=\ (1\ -\/\ fp\_iszero(Pp[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}].z));}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (1\ -\/\ boolp)}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/>\ This\ can\ be\ removed\ for\ wd1\ style}}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Checking\ if\ Tm\ is\ an\ order\ (p+1)/(2\string^e)}}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ proj\_copy(\&Pm[0],\ \&Tm);}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ctidh_8h_aef94c206880c1495cff4b5fa89212810}{cofactor\_multiples}}(Pm,\ A,\ 0,\ primes\_num);}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ boolm\ =\ 1;}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ boolm\ \&=\ (1\ -\/\ fp\_iszero(Pm[0].z))\ |\ (1\ -\/\ fp\_iszero(Aux\_Tm[0].z));}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ boolm\ \&=\ (1\ -\/\ fp\_iszero(Pm[1].z))\ |\ (1\ -\/\ fp\_iszero(Aux\_Tm[1].z));}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ boolm\ \&=\ (1\ -\/\ fp\_iszero(Pm[2].z))\ |\ (1\ -\/\ fp\_iszero(Aux\_Tm[2].z));}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ =\ 3;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}\ <\ (int)primes\_num;\ \mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}++)}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ boolm\ \&=\ (1\ -\/\ fp\_iszero(Pm[\mbox{\hyperlink{prime__search_8m_ac86694252f8dfdb19aaeadc4b7c342c6}{j}}].z));}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (1\ -\/\ boolm)}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ <-\/-\/-\/}}
\DoxyCodeLine{00171\ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ ((1\ -\/\ boolp)\ |\ (1\ -\/\ boolm));}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \mbox{\hyperlink{fp-gmp_8h_afe9d15f0be91f1759f096d7c20655fb0}{fp\_dec}}(u,\ (uint64\_t\ *\textcolor{keyword}{const})u);}
\DoxyCodeLine{00174\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{to__model_8m_source_l00012}{a}}, \mbox{\hyperlink{ctidh_8h_source_l00055}{cofactor\+\_\+multiples}}, \mbox{\hyperlink{elligator_8h_source_l00008}{elligator\+\_\+seeded}}, \mbox{\hyperlink{fp-gmp_8h_source_l00048}{fp\+\_\+1}}, \mbox{\hyperlink{fp-gmp_8h_source_l00064}{fp\+\_\+add}}, \mbox{\hyperlink{fp-gmp_8h_source_l00079}{fp\+\_\+copy}}, \mbox{\hyperlink{fp-gmp_8h_source_l00058}{fp\+\_\+dec}}, and \mbox{\hyperlink{prime__search_8m_source_l00012}{j}}.



\label{doc-var-members}
\Hypertarget{ctidh__wombat__eval_8c_doc-var-members}
\doxysubsection{Variable Documentation}
\Hypertarget{ctidh__wombat__eval_8c_ae5a97e9debf3707d97dfb35dc631a0ca}\index{ctidh\_wombat\_eval.c@{ctidh\_wombat\_eval.c}!base@{base}}
\index{base@{base}!ctidh\_wombat\_eval.c@{ctidh\_wombat\_eval.c}}
\doxysubsubsection{\texorpdfstring{base}{base}}
{\footnotesize\ttfamily \label{ctidh__wombat__eval_8c_ae5a97e9debf3707d97dfb35dc631a0ca} 
const \mbox{\hyperlink{structpublic__key}{public\+\_\+key}} base = \{.A = \{0\}, .seed = ELLIGATOR\+\_\+\+SEED\}}



Definition at line \mbox{\hyperlink{ctidh__wombat__eval_8c_source_l00024}{24}} of file \mbox{\hyperlink{ctidh__wombat__eval_8c_source}{ctidh\+\_\+wombat\+\_\+eval.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00024\ \{.A\ =\ \{0\},\ .seed\ =\ ELLIGATOR\_SEED\};\ \textcolor{comment}{/*\ A\ =\ 0\ */}}

\end{DoxyCode}
